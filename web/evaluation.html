<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAGè¯„ä¼°ä¸ç›‘æ§ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div x-data="evaluationApp()" x-init="init()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold">ğŸ”¬ RAGè¯„ä¼°ä¸ç›‘æ§ç³»ç»Ÿ</h1>
                        <p class="text-blue-100 text-sm mt-1">Chatbot Quality Assurance & A/B Testing Platform</p>
                    </div>
                    <div class="flex gap-3">
                        <a href="index.html" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">
                            è¿”å›ä¸»ç•Œé¢
                        </a>
                        <button @click="refreshData()" class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg transition">
                            ğŸ”„ åˆ·æ–°æ•°æ®
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-6 py-8">
            <!-- Navigation Tabs -->
            <div class="bg-white rounded-lg shadow-md mb-6">
                <div class="flex border-b">
                    <button @click="activeTab = 'overview'"
                            :class="activeTab === 'overview' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
                            class="px-6 py-3 font-semibold transition">
                        ğŸ“Š æ¦‚è§ˆ
                    </button>
                    <button @click="activeTab = 'standard-tests'"
                            :class="activeTab === 'standard-tests' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
                            class="px-6 py-3 font-semibold transition">
                        ğŸ“ æ ‡å‡†æµ‹è¯•
                    </button>
                    <button @click="activeTab = 'abtest'"
                            :class="activeTab === 'abtest' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
                            class="px-6 py-3 font-semibold transition">
                        ğŸ§ª A/Bæµ‹è¯•
                    </button>
                    <button @click="activeTab = 'metrics'"
                            :class="activeTab === 'metrics' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
                            class="px-6 py-3 font-semibold transition">
                        ğŸ“ˆ æŒ‡æ ‡åˆ†æ
                    </button>
                    <button @click="activeTab = 'config'"
                            :class="activeTab === 'config' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
                            class="px-6 py-3 font-semibold transition">
                        âš™ï¸ é…ç½®ç®¡ç†
                    </button>
                </div>
            </div>

            <!-- Overview Tab -->
            <div x-show="activeTab === 'overview'" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Metric Cards -->
                    <div class="metric-card bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">æ€»æµ‹è¯•æ¬¡æ•°</p>
                                <p class="text-3xl font-bold text-blue-600" x-text="overview.totalTests">0</p>
                            </div>
                            <div class="text-4xl">ğŸ“Š</div>
                        </div>
                    </div>
                    <div class="metric-card bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">å¹³å‡å‡†ç¡®ç‡</p>
                                <p class="text-3xl font-bold text-green-600" x-text="overview.avgAccuracy + '%'">0%</p>
                            </div>
                            <div class="text-4xl">âœ…</div>
                        </div>
                    </div>
                    <div class="metric-card bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">è¿è¡Œä¸­çš„A/Bæµ‹è¯•</p>
                                <p class="text-3xl font-bold text-purple-600" x-text="overview.activeABTests">0</p>
                            </div>
                            <div class="text-4xl">ğŸ§ª</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Tests -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“‹ æœ€è¿‘æµ‹è¯•è®°å½•</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">æ—¶é—´</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">é…ç½®</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">å‡†ç¡®ç‡</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">å¹³å‡å“åº”æ—¶é—´</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="test in recentTests" :key="test.id">
                                    <tr class="border-t hover:bg-gray-50">
                                        <td class="px-4 py-3 text-sm" x-text="test.timestamp"></td>
                                        <td class="px-4 py-3 text-sm" x-text="test.config"></td>
                                        <td class="px-4 py-3 text-sm">
                                            <span :class="test.accuracy >= 80 ? 'text-green-600' : test.accuracy >= 60 ? 'text-yellow-600' : 'text-red-600'"
                                                  x-text="test.accuracy + '%'"></span>
                                        </td>
                                        <td class="px-4 py-3 text-sm" x-text="test.avgResponseTime + 'ms'"></td>
                                        <td class="px-4 py-3 text-sm">
                                            <span :class="test.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                                                  class="px-2 py-1 rounded text-xs"
                                                  x-text="test.status"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Standard Tests Tab -->
            <div x-show="activeTab === 'standard-tests'" class="space-y-6">
                <!-- Test Configuration -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">âš™ï¸ æµ‹è¯•é…ç½®</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">æ¨¡å‹é€‰æ‹©</label>
                            <select x-model="testConfig.model" class="w-full px-3 py-2 border rounded-lg">
                                <option value="qwen3-max">Qwen3-Max</option>
                                <option value="auto">Auto (è‡ªåŠ¨é€‰æ‹©)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Queryæ”¹å†™ç­–ç•¥</label>
                            <select x-model="testConfig.queryStrategy" class="w-full px-3 py-2 border rounded-lg">
                                <option value="multi-version">å¤šç‰ˆæœ¬ï¼ˆ3ä¸ªï¼‰</option>
                                <option value="single">å•ç‰ˆæœ¬</option>
                                <option value="none">ä¸æ”¹å†™</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">æ£€ç´¢æ–¹æ³•</label>
                            <select x-model="testConfig.retrievalMethod" class="w-full px-3 py-2 border rounded-lg">
                                <option value="hybrid">æ··åˆï¼ˆå‘é‡+BM25ï¼‰</option>
                                <option value="vector-only">ä»…å‘é‡</option>
                                <option value="bm25-only">ä»…BM25</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Rerankæ–¹æ³•</label>
                            <select x-model="testConfig.rerankMethod" class="w-full px-3 py-2 border rounded-lg">
                                <option value="rrf">RRFèåˆ</option>
                                <option value="bm25">BM25é‡æ’</option>
                                <option value="none">ä¸é‡æ’</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Standard Questions -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“ æ ‡å‡†æµ‹è¯•é—®é¢˜ï¼ˆ5é¢˜ï¼‰</h3>
                    <div class="space-y-4">
                        <template x-for="(question, idx) in standardQuestions" :key="idx">
                            <div class="border rounded-lg p-4 hover:bg-gray-50">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">
                                        <span x-text="idx + 1"></span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 mb-2" x-text="question.question"></p>
                                        <div class="bg-green-50 border-l-4 border-green-500 p-3 text-sm">
                                            <p class="text-gray-600 font-semibold mb-1">âœ“ æ ‡å‡†ç­”æ¡ˆ:</p>
                                            <p class="text-gray-800" x-text="question.groundTruth"></p>
                                        </div>
                                        <div x-show="question.lastResult" class="mt-3 bg-blue-50 border-l-4 border-blue-500 p-3 text-sm">
                                            <p class="text-gray-600 font-semibold mb-1">ğŸ¤– æœ€è¿‘ç”Ÿæˆç­”æ¡ˆ:</p>
                                            <p class="text-gray-800" x-text="question.lastResult?.answer"></p>
                                            <div class="mt-2 flex gap-4 text-xs">
                                                <span class="font-semibold">å¾—åˆ†: <span :class="question.lastResult?.score >= 0.8 ? 'text-green-600' : 'text-yellow-600'" x-text="(question.lastResult?.score * 100).toFixed(1) + '%'"></span></span>
                                                <span class="text-gray-600">å“åº”æ—¶é—´: <span x-text="question.lastResult?.responseTime + 'ms'"></span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Run Tests Button -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <button @click="runStandardTests()"
                            :disabled="isRunning"
                            :class="isRunning ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'"
                            class="w-full py-3 text-white font-bold rounded-lg transition">
                        <span x-show="!isRunning">ğŸš€ è¿è¡Œæ ‡å‡†æµ‹è¯•</span>
                        <span x-show="isRunning">â³ æµ‹è¯•è¿è¡Œä¸­... (<span x-text="testProgress"></span>/5)</span>
                    </button>
                </div>

                <!-- Test Results -->
                <div x-show="testResults.length > 0" class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š æµ‹è¯•ç»“æœ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">æ€»ä½“å¾—åˆ†</p>
                            <p class="text-2xl font-bold" x-text="(testResults.reduce((sum, r) => sum + r.score, 0) / testResults.length * 100).toFixed(1) + '%'"></p>
                        </div>
                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">é€šè¿‡ç‡ (â‰¥80%)</p>
                            <p class="text-2xl font-bold" x-text="(testResults.filter(r => r.score >= 0.8).length / testResults.length * 100).toFixed(0) + '%'"></p>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">å¹³å‡å“åº”æ—¶é—´</p>
                            <p class="text-2xl font-bold" x-text="(testResults.reduce((sum, r) => sum + r.responseTime, 0) / testResults.length).toFixed(0) + 'ms'"></p>
                        </div>
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">å¬å›å‡†ç¡®ç‡</p>
                            <p class="text-2xl font-bold" x-text="(testResults.filter(r => r.hasRelevantDocs).length / testResults.length * 100).toFixed(0) + '%'"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- A/B Test Tab -->
            <div x-show="activeTab === 'abtest'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ§ª åˆ›å»ºA/Bæµ‹è¯•</h3>
                    <p class="text-gray-600 text-sm mb-4">æ¯”è¾ƒä¸¤ç§ä¸åŒé…ç½®çš„æ€§èƒ½è¡¨ç°</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Configuration A -->
                        <div class="border-2 border-blue-200 rounded-lg p-4">
                            <h4 class="font-bold text-blue-600 mb-3">é…ç½® A (å¯¹ç…§ç»„)</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">æ¨¡å‹</label>
                                    <select x-model="abtestConfigA.model" class="w-full px-3 py-2 border rounded">
                                        <option value="qwen3-max">Qwen3-Max</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Queryæ”¹å†™</label>
                                    <select x-model="abtestConfigA.queryStrategy" class="w-full px-3 py-2 border rounded">
                                        <option value="multi-version">å¤šç‰ˆæœ¬</option>
                                        <option value="single">å•ç‰ˆæœ¬</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">æ£€ç´¢æ–¹æ³•</label>
                                    <select x-model="abtestConfigA.retrievalMethod" class="w-full px-3 py-2 border rounded">
                                        <option value="hybrid">æ··åˆ</option>
                                        <option value="vector-only">ä»…å‘é‡</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Configuration B -->
                        <div class="border-2 border-green-200 rounded-lg p-4">
                            <h4 class="font-bold text-green-600 mb-3">é…ç½® B (å®éªŒç»„)</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">æ¨¡å‹</label>
                                    <select x-model="abtestConfigB.model" class="w-full px-3 py-2 border rounded">
                                        <option value="qwen3-max">Qwen3-Max</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Queryæ”¹å†™</label>
                                    <select x-model="abtestConfigB.queryStrategy" class="w-full px-3 py-2 border rounded">
                                        <option value="multi-version">å¤šç‰ˆæœ¬</option>
                                        <option value="single">å•ç‰ˆæœ¬</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">æ£€ç´¢æ–¹æ³•</label>
                                    <select x-model="abtestConfigB.retrievalMethod" class="w-full px-3 py-2 border rounded">
                                        <option value="hybrid">æ··åˆ</option>
                                        <option value="vector-only">ä»…å‘é‡</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button @click="runABTest()" class="mt-6 w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition">
                        ğŸš€ å¯åŠ¨A/Bæµ‹è¯•
                    </button>
                </div>

                <!-- A/B Test Results -->
                <div x-show="abtestResults" class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š A/Bæµ‹è¯•ç»“æœå¯¹æ¯”</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold">æŒ‡æ ‡</th>
                                    <th class="px-4 py-2 text-center text-sm font-semibold text-blue-600">é…ç½® A</th>
                                    <th class="px-4 py-2 text-center text-sm font-semibold text-green-600">é…ç½® B</th>
                                    <th class="px-4 py-2 text-center text-sm font-semibold">å·®å¼‚</th>
                                </tr>
                            </thead>
                            <tbody x-show="abtestResults">
                                <tr class="border-t">
                                    <td class="px-4 py-3 font-semibold">å¹³å‡å‡†ç¡®ç‡</td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configA?.accuracy + '%'"></td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configB?.accuracy + '%'"></td>
                                    <td class="px-4 py-3 text-center">
                                        <span :class="abtestResults?.configB?.accuracy > abtestResults?.configA?.accuracy ? 'text-green-600' : 'text-red-600'"
                                              x-text="(abtestResults?.configB?.accuracy - abtestResults?.configA?.accuracy > 0 ? '+' : '') + (abtestResults?.configB?.accuracy - abtestResults?.configA?.accuracy).toFixed(1) + '%'"></span>
                                    </td>
                                </tr>
                                <tr class="border-t">
                                    <td class="px-4 py-3 font-semibold">å¹³å‡å“åº”æ—¶é—´</td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configA?.avgResponseTime + 'ms'"></td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configB?.avgResponseTime + 'ms'"></td>
                                    <td class="px-4 py-3 text-center">
                                        <span :class="abtestResults?.configB?.avgResponseTime < abtestResults?.configA?.avgResponseTime ? 'text-green-600' : 'text-red-600'"
                                              x-text="(abtestResults?.configB?.avgResponseTime - abtestResults?.configA?.avgResponseTime > 0 ? '+' : '') + (abtestResults?.configB?.avgResponseTime - abtestResults?.configA?.avgResponseTime).toFixed(0) + 'ms'"></span>
                                    </td>
                                </tr>
                                <tr class="border-t">
                                    <td class="px-4 py-3 font-semibold">å¬å›å‡†ç¡®ç‡</td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configA?.recallAccuracy + '%'"></td>
                                    <td class="px-4 py-3 text-center" x-text="abtestResults?.configB?.recallAccuracy + '%'"></td>
                                    <td class="px-4 py-3 text-center">
                                        <span :class="abtestResults?.configB?.recallAccuracy > abtestResults?.configA?.recallAccuracy ? 'text-green-600' : 'text-red-600'"
                                              x-text="(abtestResults?.configB?.recallAccuracy - abtestResults?.configA?.recallAccuracy > 0 ? '+' : '') + (abtestResults?.configB?.recallAccuracy - abtestResults?.configA?.recallAccuracy).toFixed(1) + '%'"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Metrics Tab -->
            <div x-show="activeTab === 'metrics'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿</h3>
                    <p class="text-gray-600 text-sm">æ­¤åŠŸèƒ½å°†å±•ç¤ºå†å²æµ‹è¯•æ•°æ®çš„è¶‹åŠ¿å›¾è¡¨ï¼ˆå¾…å®ç°å›¾è¡¨åº“ï¼‰</p>
                </div>
            </div>

            <!-- Config Tab -->
            <div x-show="activeTab === 'config'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold mb-4">âš™ï¸ ç³»ç»Ÿé…ç½®</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">APIåŸºç¡€URL</label>
                            <input type="text" x-model="config.apiBaseUrl" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">é»˜è®¤ä¼šè¯ID</label>
                            <input type="text" x-model="config.sessionId" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <button @click="saveConfig()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                            ğŸ’¾ ä¿å­˜é…ç½®
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function evaluationApp() {
            return {
                activeTab: 'overview',

                // Overview data
                overview: {
                    totalTests: 0,
                    avgAccuracy: 0,
                    activeABTests: 0
                },

                recentTests: [],

                // Test configuration
                testConfig: {
                    model: 'qwen3-max',
                    queryStrategy: 'multi-version',
                    retrievalMethod: 'hybrid',
                    rerankMethod: 'rrf'
                },

                // Standard questions with ground truth
                standardQuestions: [
                    {
                        question: "ä»€ä¹ˆæ˜¯RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ",
                        groundTruth: "RAGæ˜¯ä¸€ç§ç»“åˆäº†ä¿¡æ¯æ£€ç´¢å’Œç”Ÿæˆå¼AIçš„æŠ€æœ¯ã€‚å®ƒé¦–å…ˆä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œç„¶ååŸºäºæ£€ç´¢åˆ°çš„å†…å®¹ç”Ÿæˆå›ç­”ã€‚ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š1ï¼‰å‡å°‘å¹»è§‰ï¼Œæé«˜å‡†ç¡®æ€§ï¼›2ï¼‰èƒ½å¤Ÿåˆ©ç”¨æœ€æ–°çš„å¤–éƒ¨çŸ¥è¯†ï¼›3ï¼‰å¯ä»¥æä¾›æ¥æºå¼•ç”¨ï¼›4ï¼‰æ— éœ€é‡æ–°è®­ç»ƒæ¨¡å‹å°±èƒ½æ›´æ–°çŸ¥è¯†ã€‚",
                        lastResult: null
                    },
                    {
                        question: "BM25ç®—æ³•çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ",
                        groundTruth: "BM25æ˜¯ä¸€ç§åŸºäºè¯é¢‘çš„ä¿¡æ¯æ£€ç´¢ç®—æ³•ã€‚å®ƒé€šè¿‡ä»¥ä¸‹å› ç´ è®¡ç®—ç›¸å…³æ€§å¾—åˆ†ï¼š1ï¼‰è¯é¢‘TFï¼ˆTerm Frequencyï¼‰ï¼šè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡ï¼Œä½¿ç”¨é¥±å’Œå‡½æ•°é¿å…è¿‡åº¦å¥–åŠ±é«˜é¢‘è¯ï¼›2ï¼‰é€†æ–‡æ¡£é¢‘ç‡IDFï¼ˆInverse Document Frequencyï¼‰ï¼šè¯çš„ç¨€æœ‰ç¨‹åº¦ï¼Œç¨€æœ‰è¯æƒé‡æ›´é«˜ï¼›3ï¼‰æ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–ï¼šè¾ƒé•¿æ–‡æ¡£ä¸ä¼šè·å¾—ä¸å…¬å¹³çš„ä¼˜åŠ¿ã€‚å…¬å¼æ ¸å¿ƒå‚æ•°åŒ…æ‹¬k1ï¼ˆæ§åˆ¶TFé¥±å’Œåº¦ï¼‰å’Œbï¼ˆæ§åˆ¶é•¿åº¦å½’ä¸€åŒ–ï¼‰ã€‚",
                        lastResult: null
                    },
                    {
                        question: "å‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ",
                        groundTruth: "å‘é‡æ£€ç´¢ä¼˜ç‚¹ï¼šèƒ½æ•æ‰è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œå¯¹åŒä¹‰è¯å’Œæ”¹å†™é²æ£’ï¼Œé€‚åˆè¯­ä¹‰ç†è§£ä»»åŠ¡ã€‚ç¼ºç‚¹ï¼šè®¡ç®—æˆæœ¬é«˜ï¼Œå¯¹ç²¾ç¡®åŒ¹é…æ”¯æŒå¼±ã€‚å…³é”®è¯æ£€ç´¢ï¼ˆå¦‚BM25ï¼‰ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ï¼Œç²¾ç¡®åŒ¹é…æ•ˆæœå¥½ï¼Œå¯è§£é‡Šæ€§å¼ºã€‚ç¼ºç‚¹ï¼šæ— æ³•ç†è§£è¯­ä¹‰ï¼Œå¯¹åŒä¹‰è¯å’Œæ”¹å†™æ•æ„Ÿã€‚æœ€ä½³å®è·µæ˜¯æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰ï¼Œç»“åˆä¸¤è€…ä¼˜åŠ¿ã€‚",
                        lastResult: null
                    },
                    {
                        question: "ä»€ä¹ˆæ˜¯RRFï¼ˆå€’æ•°æ’åèåˆï¼‰ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿ",
                        groundTruth: "RRFæ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»“æœèåˆæ–¹æ³•ã€‚å¯¹äºæ–‡æ¡£dï¼ŒRRFå¾—åˆ† = Î£ 1/(k + rank_i)ï¼Œå…¶ä¸­rank_iæ˜¯æ–‡æ¡£åœ¨ç¬¬iä¸ªæ’åºåˆ—è¡¨ä¸­çš„æ’åï¼Œkæ˜¯å¹³æ»‘å‚æ•°ï¼ˆé€šå¸¸å–60ï¼‰ã€‚RRFçš„ä¼˜ç‚¹ï¼š1ï¼‰ä¸éœ€è¦å½’ä¸€åŒ–åˆ†æ•°ï¼›2ï¼‰å¯¹ä¸åŒæ£€ç´¢ç³»ç»Ÿçš„åˆ†æ•°å°ºåº¦ä¸æ•æ„Ÿï¼›3ï¼‰å®ç°ç®€å•ä½†æ•ˆæœå¥½ã€‚å¸¸ç”¨äºæ··åˆæ£€ç´¢ä¸­èåˆå‘é‡æ£€ç´¢å’ŒBM25çš„ç»“æœã€‚",
                        lastResult: null
                    },
                    {
                        question: "Queryæ”¹å†™åœ¨RAGä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ",
                        groundTruth: "Queryæ”¹å†™æ˜¯å°†ç”¨æˆ·åŸå§‹é—®é¢˜è½¬æ¢ä¸ºæ›´é€‚åˆæ£€ç´¢çš„å½¢å¼ï¼Œä»¥æé«˜å¬å›ç‡å’Œå‡†ç¡®æ€§ã€‚ä½œç”¨åŒ…æ‹¬ï¼š1ï¼‰å±•å¼€ç¼©å†™è¯å’Œç®€ç§°ï¼›2ï¼‰è¡¥å……ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›3ï¼‰ç”Ÿæˆå¤šä¸ªæ£€ç´¢è§†è§’ã€‚å®ç°æ–¹æ³•ï¼š1ï¼‰åŸºäºè§„åˆ™çš„æ”¹å†™ï¼›2ï¼‰ä½¿ç”¨LLMç”Ÿæˆæ”¹å†™ç‰ˆæœ¬ï¼›3ï¼‰ç”Ÿæˆå¤šä¸ªç‰ˆæœ¬ï¼ˆæ‰©å±•ç‰ˆã€å…³é”®è¯ç‰ˆã€åŒä¹‰è¯ç‰ˆï¼‰å¹¶åˆ†åˆ«æ£€ç´¢åèåˆç»“æœã€‚å¤šç‰ˆæœ¬æ”¹å†™å¯ä»¥è¦†ç›–ä¸åŒçš„æ£€ç´¢éœ€æ±‚ï¼Œæå‡æ•´ä½“å¬å›æ•ˆæœã€‚",
                        lastResult: null
                    }
                ],

                testResults: [],
                isRunning: false,
                testProgress: 0,

                // A/B test config
                abtestConfigA: {
                    model: 'qwen3-max',
                    queryStrategy: 'multi-version',
                    retrievalMethod: 'hybrid'
                },
                abtestConfigB: {
                    model: 'qwen3-max',
                    queryStrategy: 'single',
                    retrievalMethod: 'vector-only'
                },
                abtestResults: null,

                // System config
                config: {
                    apiBaseUrl: 'http://localhost:8000',
                    sessionId: 'eval-session-001'
                },

                init() {
                    console.log('Evaluation system initialized');
                    this.loadMockData();
                },

                loadMockData() {
                    // Mock data for demonstration
                    this.overview = {
                        totalTests: 12,
                        avgAccuracy: 78.5,
                        activeABTests: 2
                    };

                    this.recentTests = [
                        {
                            id: 1,
                            timestamp: '2026-01-01 14:30',
                            config: 'å¤šç‰ˆæœ¬Query + æ··åˆæ£€ç´¢',
                            accuracy: 85.2,
                            avgResponseTime: 1250,
                            status: 'completed'
                        },
                        {
                            id: 2,
                            timestamp: '2026-01-01 13:15',
                            config: 'å•ç‰ˆæœ¬Query + å‘é‡æ£€ç´¢',
                            accuracy: 72.8,
                            avgResponseTime: 980,
                            status: 'completed'
                        }
                    ];
                },

                async runStandardTests() {
                    this.isRunning = true;
                    this.testResults = [];
                    this.testProgress = 0;

                    try {
                        // Call backend API to run all standard tests
                        const response = await fetch(`${this.config.apiBaseUrl}/api/evaluation/run-standard-test`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: this.testConfig.model,
                                query_strategy: this.testConfig.queryStrategy,
                                retrieval_method: this.testConfig.retrievalMethod,
                                rerank_method: this.testConfig.rerankMethod,
                                use_rag: true
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API returned ${response.status}`);
                        }

                        const results = await response.json();

                        // Update UI with results
                        this.testResults = results.map(r => ({
                            question: r.question,
                            answer: r.answer,
                            groundTruth: r.ground_truth,
                            score: r.score,
                            responseTime: r.response_time,
                            hasRelevantDocs: r.has_relevant_docs,
                            ragDocumentsCount: r.rag_documents_count
                        }));

                        // Update last results for each question
                        results.forEach((result, idx) => {
                            if (this.standardQuestions[idx]) {
                                this.standardQuestions[idx].lastResult = {
                                    answer: result.answer,
                                    score: result.score,
                                    responseTime: result.response_time
                                };
                            }
                        });

                        alert('âœ… æ ‡å‡†æµ‹è¯•å®Œæˆï¼');
                    } catch (error) {
                        console.error('Test failed:', error);
                        alert('âŒ æµ‹è¯•å¤±è´¥: ' + error.message);
                    } finally {
                        this.isRunning = false;
                    }
                },

                async runABTest() {
                    if (!confirm('ğŸ§ª ç¡®å®šè¦è¿è¡ŒA/Bæµ‹è¯•å—ï¼Ÿè¿™å°†è¿è¡Œ2ç»„æµ‹è¯•ï¼Œæ¯ç»„5ä¸ªé—®é¢˜ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚')) {
                        return;
                    }

                    this.isRunning = true;

                    try {
                        const response = await fetch(`${this.config.apiBaseUrl}/api/evaluation/run-abtest`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                config_a: {
                                    model: this.abtestConfigA.model,
                                    query_strategy: this.abtestConfigA.queryStrategy,
                                    retrieval_method: this.abtestConfigA.retrievalMethod,
                                    rerank_method: 'rrf',
                                    use_rag: true
                                },
                                config_b: {
                                    model: this.abtestConfigB.model,
                                    query_strategy: this.abtestConfigB.queryStrategy,
                                    retrieval_method: this.abtestConfigB.retrievalMethod,
                                    rerank_method: 'rrf',
                                    use_rag: true
                                },
                                test_questions: [1, 2, 3, 4, 5]
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API returned ${response.status}`);
                        }

                        const result = await response.json();

                        this.abtestResults = {
                            configA: {
                                accuracy: result.config_a_results.accuracy,
                                avgResponseTime: result.config_a_results.avg_response_time,
                                recallAccuracy: result.config_a_results.recall_accuracy
                            },
                            configB: {
                                accuracy: result.config_b_results.accuracy,
                                avgResponseTime: result.config_b_results.avg_response_time,
                                recallAccuracy: result.config_b_results.recall_accuracy
                            }
                        };

                        const winnerMsg = result.winner === 'A' ? 'é…ç½®Aè·èƒœï¼' :
                                         result.winner === 'B' ? 'é…ç½®Bè·èƒœï¼' :
                                         'ä¸¤è€…è¡¨ç°ç›¸å½“ï¼';
                        alert(`âœ… A/Bæµ‹è¯•å®Œæˆï¼${winnerMsg}`);
                    } catch (error) {
                        console.error('A/B test failed:', error);
                        alert('âŒ A/Bæµ‹è¯•å¤±è´¥: ' + error.message);
                    } finally {
                        this.isRunning = false;
                    }
                },

                refreshData() {
                    this.loadMockData();
                    alert('ğŸ”„ æ•°æ®å·²åˆ·æ–°');
                },

                saveConfig() {
                    localStorage.setItem('evalConfig', JSON.stringify(this.config));
                    alert('ğŸ’¾ é…ç½®å·²ä¿å­˜');
                }
            };
        }
    </script>
</body>
</html>
