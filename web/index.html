<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢è¯•é¢˜ç»ƒä¹ ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Markdownæ¸²æŸ“åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }

        /* Line clamp utility */
        .line-clamp-10 {
            display: -webkit-box;
            -webkit-line-clamp: 10;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Markdownå†…å®¹æ ·å¼ */
        .prose {
            color: #374151;
            max-width: none;
        }
        .prose h1 { font-size: 2em; font-weight: bold; margin-top: 0.67em; margin-bottom: 0.67em; }
        .prose h2 { font-size: 1.5em; font-weight: bold; margin-top: 0.83em; margin-bottom: 0.83em; }
        .prose h3 { font-size: 1.17em; font-weight: bold; margin-top: 1em; margin-bottom: 1em; }
        .prose p { margin: 1em 0; line-height: 1.6; }
        .prose ul, .prose ol { margin: 1em 0; padding-left: 2em; }
        .prose li { margin: 0.5em 0; }
        .prose code { background-color: #f3f4f6; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; }
        .prose pre { background-color: #1f2937; color: #f3f4f6; padding: 1em; border-radius: 0.375rem; overflow-x: auto; margin: 1em 0; }
        .prose pre code { background: none; padding: 0; }
        .prose blockquote { border-left: 4px solid #d1d5db; padding-left: 1em; margin: 1em 0; color: #6b7280; }
        .prose a { color: #2563eb; text-decoration: underline; }
        .prose strong { font-weight: bold; }
        .prose em { font-style: italic; }
        .prose table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        .prose th, .prose td { border: 1px solid #d1d5db; padding: 0.5em; text-align: left; }
        .prose th { background-color: #f3f4f6; font-weight: bold; }

        /* é¢è¯•æ—¥ç¨‹æ»šåŠ¨åŠ¨ç”» */
        .interview-scroll {
            overflow: hidden;
            width: 100%;
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        .animate-scroll {
            display: flex;
            animation: scroll 30s linear infinite;
        }

        .animate-scroll:hover {
            animation-play-state: paused;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div x-data="app()" x-init="init()" class="min-h-screen">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-900">ğŸ¯ é¢è¯•é¢˜ç»ƒä¹ ç³»ç»Ÿ</h1>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button @click="currentTab = 'practice'"
                                :class="currentTab === 'practice' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            ç»ƒä¹ æ¨¡å¼
                        </button>
                        <button @click="currentTab = 'chatbot'"
                                :class="currentTab === 'chatbot' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            ğŸ¤– AIåŠ©æ‰‹
                        </button>
                        <button @click="currentTab = 'notes'"
                                :class="currentTab === 'notes' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            ğŸ“ ç¬”è®°
                        </button>
                        <button @click="currentTab = 'schedules'"
                                :class="currentTab === 'schedules' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            ğŸ“… é¢è¯•æ—¥ç¨‹
                        </button>
                        <button @click="currentTab = 'job-analysis'"
                                :class="currentTab === 'job-analysis' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            ğŸ’¼ å²—ä½åˆ†æ
                        </button>
                        <button @click="window.open('https://www.overleaf.com/', '_blank')"
                                class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-100">
                            ğŸ“„ ç®€å†
                        </button>
                        <button @click="currentTab = 'source'"
                                :class="currentTab === 'source' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            åŸå§‹é—®é¢˜
                        </button>
                        <button @click="currentTab = 'questions'"
                                :class="currentTab === 'questions' ? 'bg-blue-100 text-blue-700' : 'text-gray-600'"
                                class="px-3 py-2 rounded-md text-sm font-medium">
                            æ˜ç»†é—®é¢˜
                        </button>
                        <button @click="showSettings = true"
                                class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-100">
                            âš™ï¸ è®¾ç½®
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            <!-- ç»ƒä¹ æ¨¡å¼ -->
            <div x-show="currentTab === 'practice'" x-cloak>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-sm font-medium text-gray-500">æ€»é—®é¢˜æ•°</h3>
                        <p class="mt-2 text-3xl font-bold text-gray-900" x-text="stats.total_questions"></p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-sm font-medium text-gray-500">å·²ç»ƒä¹ </h3>
                        <p class="mt-2 text-3xl font-bold text-blue-600" x-text="stats.practiced_questions"></p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-sm font-medium text-gray-500">å·²æŒæ¡</h3>
                        <p class="mt-2 text-3xl font-bold text-green-600" x-text="stats.mastery_stats?.['ä¼šäº†'] || 0"></p>
                    </div>
                </div>

                <!-- é¢è¯•æ—¥ç¨‹æ»šåŠ¨æé†’ -->
                <div x-show="upcomingInterviews.length > 0" class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 rounded-lg shadow p-4 mb-6 overflow-hidden">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-yellow-800">ğŸ“… æœªæ¥7å¤©é¢è¯•æé†’</h3>
                        <button @click="currentTab = 'schedules'" class="text-xs text-yellow-700 hover:underline">æŸ¥çœ‹å…¨éƒ¨</button>
                    </div>
                    <div class="interview-scroll">
                        <div class="flex space-x-4 animate-scroll">
                            <template x-for="(interview, idx) in (upcomingInterviews || []).concat(upcomingInterviews || [])" :key="'scroll-' + interview.id + '-' + idx">
                                <div class="flex-shrink-0 bg-white rounded-md p-3 border border-yellow-200 min-w-[300px]">
                                    <p class="font-medium text-gray-900 text-sm" x-text="interview.company_name + ' - ' + interview.position_name"></p>
                                    <p class="text-xs text-gray-600 mt-1">
                                        ğŸ•’ <span x-text="new Date(interview.interview_time).toLocaleString()"></span>
                                    </p>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- ç­›é€‰é€‰é¡¹ -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">ç­›é€‰æ¡ä»¶</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¢†åŸŸ</label>
                            <select x-model="practiceFilter.domain" class="w-full border rounded-md px-3 py-2">
                                <option value="">å…¨éƒ¨é¢†åŸŸ</option>
                                <option>å¤§æ¨¡å‹</option>
                                <option>RAG</option>
                                <option>è®°å¿†ç®¡ç†</option>
                                <option>Langchainè¯­æ³•</option>
                                <option>æ™ºèƒ½ä½“æ¡†æ¶</option>
                                <option>æ•ˆæœè¯„æµ‹</option>
                                <option>å·¥ç¨‹åŒ–éƒ¨ç½²å®è·µ</option>
                                <option>å…¶ä»–</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æŒæ¡ç¨‹åº¦</label>
                            <select x-model="practiceFilter.mastery_level" class="w-full border rounded-md px-3 py-2">
                                <option value="">å…¨éƒ¨</option>
                                <option value="NULL">æœªç»ƒä¹ </option>
                                <option value="ä¸ä¼š">ä¸ä¼š</option>
                                <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
                                <option value="ä¼šäº†">ä¼šäº†</option>
                            </select>
                        </div>
                    </div>
                    <button @click="getRandomQuestion()"
                            class="mt-4 w-full bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700">
                        ğŸ² éšæœºå‡ºé¢˜
                    </button>
                </div>

                <!-- å½“å‰é—®é¢˜ -->
                <div x-show="currentQuestion" x-cloak class="bg-white rounded-lg shadow p-6">
                    <div class="mb-4">
                        <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full"
                              x-text="currentQuestion?.domain"></span>
                        <span x-show="currentQuestion?.latest_mastery_level"
                              :class="{
                                  'ä¸ä¼š': 'bg-red-100 text-red-800',
                                  'ä¸€èˆ¬': 'bg-yellow-100 text-yellow-800',
                                  'ä¼šäº†': 'bg-green-100 text-green-800'
                              }[currentQuestion?.latest_mastery_level]"
                              class="ml-2 inline-block px-3 py-1 text-sm font-medium rounded-full"
                              x-text="currentQuestion?.latest_mastery_level"></span>
                    </div>

                    <h2 class="text-xl font-bold text-gray-900 mb-4 whitespace-pre-wrap"
                        x-text="currentQuestion?.refined_question || currentQuestion?.question"></h2>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ä½ çš„å›ç­”</label>
                        <textarea x-model="userAnswer"
                                  rows="6"
                                  class="w-full border rounded-md px-3 py-2"
                                  placeholder="è¯·è¾“å…¥ä½ çš„å›ç­”..."></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">æŒæ¡ç¨‹åº¦</label>
                        <div class="flex space-x-4">
                            <button @click="mastery = 'ä¸ä¼š'"
                                    :class="mastery === 'ä¸ä¼š' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="flex-1 px-4 py-2 rounded-md font-medium">ä¸ä¼š</button>
                            <button @click="mastery = 'ä¸€èˆ¬'"
                                    :class="mastery === 'ä¸€èˆ¬' ? 'bg-yellow-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="flex-1 px-4 py-2 rounded-md font-medium">ä¸€èˆ¬</button>
                            <button @click="mastery = 'ä¼šäº†'"
                                    :class="mastery === 'ä¼šäº†' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="flex-1 px-4 py-2 rounded-md font-medium">ä¼šäº†</button>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button @click="submitAnswer()"
                                :disabled="!userAnswer || !mastery || submittingAnswer"
                                class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700 disabled:bg-gray-400">
                            <span x-show="!submittingAnswer">ğŸ’¾ æäº¤ç­”æ¡ˆå¹¶è·å–è¯„åˆ†</span>
                            <span x-show="submittingAnswer">ğŸ”„ AIè¯„åˆ†ä¸­...</span>
                        </button>
                        <button @click="markOnly()"
                                :disabled="!mastery"
                                class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-md font-medium hover:bg-gray-700 disabled:bg-gray-400">
                            âœ“ ä»…æ ‡è®°æŒæ¡ç¨‹åº¦
                        </button>
                    </div>

                    <!-- AIè¯„åˆ†ç»“æœ -->
                    <div x-show="scoreResult" x-cloak class="mt-6 p-4 bg-blue-50 rounded-md">
                        <h3 class="font-semibold mb-2">AIè¯„åˆ†ï¼š<span class="text-2xl text-blue-600" x-text="scoreResult?.ai_score"></span> åˆ†</h3>
                        <p class="text-sm text-gray-700 mb-3 whitespace-pre-wrap" x-text="scoreResult?.ai_feedback"></p>

                        <details class="mt-3">
                            <summary class="cursor-pointer font-medium text-blue-600">æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>
                            <div class="mt-2 p-3 bg-white rounded border">
                                <p class="text-sm whitespace-pre-wrap" x-text="scoreResult?.reference_answer"></p>
                                <p class="mt-2 text-xs text-gray-500">
                                    <strong>å…³é”®è¯:</strong> <span x-text="scoreResult?.keywords"></span>
                                </p>
                            </div>
                        </details>
                    </div>

                    <!-- ä»…æ ‡è®°åæ˜¾ç¤ºç­”æ¡ˆ -->
                    <div x-show="markedOnly && !scoreResult && currentQuestion?.has_answer" x-cloak class="mt-6 p-4 bg-green-50 rounded-md border border-green-200">
                        <h3 class="font-semibold mb-3 text-green-800">âœ“ å·²æ ‡è®°ä¸ºï¼š<span x-text="mastery"></span></h3>
                        <details class="mt-3" open>
                            <summary class="cursor-pointer font-medium text-green-700">æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>
                            <div class="mt-2 p-3 bg-white rounded border">
                                <p class="text-sm whitespace-pre-wrap" x-text="currentQuestion?.answer"></p>
                                <p class="mt-2 text-xs text-gray-500">
                                    <strong>å…³é”®è¯:</strong> <span x-text="currentQuestion?.keywords"></span>
                                </p>
                            </div>
                        </details>
                    </div>

                    <button @click="getRandomQuestion(); scoreResult = null; userAnswer = ''; mastery = null; markedOnly = false;"
                            class="mt-4 w-full bg-green-600 text-white px-6 py-3 rounded-md font-medium hover:bg-green-700">
                        â¡ï¸ ä¸‹ä¸€é¢˜
                    </button>
                </div>

                <div x-show="!currentQuestion" class="bg-white rounded-lg shadow p-12 text-center">
                    <p class="text-gray-500">ç‚¹å‡»"éšæœºå‡ºé¢˜"å¼€å§‹ç»ƒä¹ </p>
                </div>
            </div>

            <!-- AIåŠ©æ‰‹ Chatbot -->
            <div x-show="currentTab === 'chatbot'" x-cloak>
                <div class="bg-white rounded-lg shadow h-[calc(100vh-200px)] flex">
                    <!-- å·¦ä¾§ä¼šè¯åˆ—è¡¨ -->
                    <div class="w-64 border-r flex flex-col">
                        <div class="p-4 border-b">
                            <button @click="startNewChat()"
                                    class="w-full px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 flex items-center justify-center">
                                <span class="mr-2">â•</span> æ–°å»ºå¯¹è¯
                            </button>
                        </div>
                        <div class="flex-1 overflow-y-auto">
                            <template x-for="(session, idx) in chatSessions" :key="session.sessionId">
                                <div @click="switchToSession(idx)"
                                     :class="currentChatSessionIndex === idx ? 'bg-blue-50 border-l-4 border-blue-600' : 'hover:bg-gray-50'"
                                     class="p-3 cursor-pointer border-b transition-colors">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1 min-w-0">
                                            <p class="font-medium text-sm truncate" x-text="session.sessionName"></p>
                                            <p class="text-xs text-gray-500 mt-1">
                                                <span x-text="session.messages.length"></span> æ¡æ¶ˆæ¯
                                            </p>
                                        </div>
                                        <button @click.stop="deleteSession(idx)"
                                                class="ml-2 text-red-500 hover:text-red-700 text-xs">
                                            âœ•
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- å³ä¾§å¯¹è¯åŒºåŸŸ -->
                    <div class="flex-1 flex flex-col">
                        <!-- Chatbot å¤´éƒ¨ -->
                        <div class="border-b p-4 flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-semibold">ğŸ¤– AIé¢è¯•åŠ©æ‰‹</h2>
                                <p class="text-sm text-gray-500" x-show="currentSession" x-text="currentSession?.sessionName"></p>
                            </div>
                            <div class="flex items-center space-x-3 flex-wrap">
                            <!-- RAGå¼€å…³ -->
                            <label class="flex items-center space-x-2 text-sm">
                                <input type="checkbox" x-model="chatUseRag" class="rounded">
                                <span>ğŸ“š çŸ¥è¯†åº“</span>
                            </label>

                            <!-- è”ç½‘æœç´¢å¼€å…³ -->
                            <label class="flex items-center space-x-2 text-sm text-blue-600">
                                <input type="checkbox" x-model="chatEnableSearch" class="rounded border-blue-400">
                                <span>ğŸŒ è”ç½‘æœç´¢</span>
                            </label>

                            <!-- æ¨¡å‹é€‰æ‹© -->
                            <select x-model="chatModel" class="border rounded-md px-3 py-1 text-sm">
                                <option value="">è‡ªåŠ¨é€‰æ‹©</option>
                                <option value="qwen-turbo">âš¡ Qwen-Turbo (æé€Ÿ)</option>
                                <option value="qwen2.5-7b">âš¡âš¡ Qwen2.5-7B (è¶…å¿«)</option>
                                <option value="qwen3-max">ğŸ¯ Qwen3-Max (é«˜è´¨é‡)</option>
                                <option value="deepseek-v3">ğŸ”„ DeepSeek-V3</option>
                            </select>

                            <!-- å¼€å‘è€…æ¨¡å¼ -->
                            <label class="flex items-center space-x-2 text-sm text-orange-600">
                                <input type="checkbox" x-model="chatDevMode" class="rounded border-orange-400">
                                <span>ğŸ”§ å¼€å‘è€…</span>
                            </label>
                            </div>
                        </div>

                    <!-- å¼€å‘è€…è°ƒè¯•é¢æ¿ -->
                    <div x-show="chatDevMode && chatDebugHistory.length > 0" x-cloak
                         class="border-b bg-gradient-to-r from-orange-50 to-yellow-50">
                        <details class="p-4" open>
                            <summary class="cursor-pointer font-semibold text-orange-700 flex items-center space-x-2">
                                <span>ğŸ”§ å¼€å‘è€…è°ƒè¯•ä¿¡æ¯</span>
                                <span class="text-xs bg-orange-200 px-2 py-1 rounded-full">å…± <span x-text="chatDebugHistory.length"></span> è½®å¯¹è¯</span>
                            </summary>

                            <!-- Tabs for different rounds -->
                            <div class="mt-4 flex space-x-2 border-b border-orange-200 overflow-x-auto">
                                <template x-for="(debugInfo, idx) in chatDebugHistory" :key="idx">
                                    <button @click="chatDebugCurrentTab = idx"
                                            :class="chatDebugCurrentTab === idx ? 'bg-orange-500 text-white' : 'bg-white text-orange-700 hover:bg-orange-100'"
                                            class="px-4 py-2 rounded-t-md text-sm font-medium whitespace-nowrap transition-colors">
                                        ç¬¬ <span x-text="idx + 1"></span> è½®
                                        <span class="text-xs ml-1" x-show="debugInfo.timings && debugInfo.timings.total">
                                            (<span x-text="debugInfo.timings.total.toFixed(2)"></span>s)
                                        </span>
                                    </button>
                                </template>
                            </div>

                            <!-- Tab contentæ˜¾ç¤ºå½“å‰é€‰ä¸­è½®æ¬¡çš„ä¿¡æ¯ -->
                            <div x-show="chatDebugHistory[chatDebugCurrentTab]" class="mt-4 space-y-4 text-sm">
                                <!-- åŸºæœ¬ä¿¡æ¯ + æ€§èƒ½è®¡æ—¶ -->
                                <div class="bg-white rounded-lg p-3 border border-orange-200">
                                    <h4 class="font-semibold text-gray-700 mb-2">ğŸ“Œ åŸºæœ¬ä¿¡æ¯</h4>
                                    <div class="space-y-1 text-xs font-mono">
                                        <p><strong>Session ID:</strong> <span x-text="chatDebugHistory[chatDebugCurrentTab]?.session_id"></span></p>
                                        <p><strong>Model:</strong> <span x-text="chatDebugHistory[chatDebugCurrentTab]?.model"></span></p>
                                        <p><strong>å½“å‰è½®æ¬¡:</strong> ç¬¬ <span x-text="chatDebugCurrentTab + 1"></span> è½®</p>
                                        <p><strong>å¯¹è¯è½®æ•°:</strong> <span x-text="chatDebugHistory[chatDebugCurrentTab]?.context?.conversation_rounds"></span></p>
                                        <p><strong>æ€»æ¶ˆæ¯æ•°:</strong> <span x-text="chatDebugHistory[chatDebugCurrentTab]?.context?.total_messages"></span></p>
                                    </div>

                                    <!-- æ€§èƒ½è®¡æ—¶ - å§‹ç»ˆæ˜¾ç¤º -->
                                    <div class="mt-3 pt-3 border-t border-orange-100">
                                        <h5 class="font-semibold text-gray-700 mb-2">â±ï¸ æ€§èƒ½è®¡æ—¶</h5>
                                        <div class="space-y-1 text-xs">
                                            <p>
                                                <strong>Queryæ”¹å†™:</strong>
                                                <span x-text="(chatDebugHistory[chatDebugCurrentTab]?.timings?.query_rewrite || 0).toFixed(3)"></span>s
                                            </p>
                                            <p>
                                                <strong>RAGæ£€ç´¢:</strong>
                                                <span x-text="(chatDebugHistory[chatDebugCurrentTab]?.timings?.rag_retrieval || 0).toFixed(3)"></span>s
                                            </p>
                                            <p>
                                                <strong>LLMç”Ÿæˆ:</strong>
                                                <span x-text="(chatDebugHistory[chatDebugCurrentTab]?.timings?.llm_generation || 0).toFixed(3)"></span>s
                                            </p>
                                            <p>
                                                <strong class="text-orange-700">æ€»è€—æ—¶:</strong>
                                                <span class="text-orange-700 font-bold" x-text="(chatDebugHistory[chatDebugCurrentTab]?.timings?.total || 0).toFixed(3)"></span>s
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- RAGæ£€ç´¢ç»“æœ -->
                                <div class="bg-white rounded-lg p-3 border border-blue-200">
                                    <h4 class="font-semibold text-gray-700 mb-2">ğŸ” RAGçŸ¥è¯†æ£€ç´¢</h4>
                                    <div x-show="chatDebugHistory[chatDebugCurrentTab]?.rag?.enabled">
                                        <!-- Queryæ”¹å†™ä¿¡æ¯ - 3ä¸ªç‰ˆæœ¬ -->
                                        <div x-show="chatDebugHistory[chatDebugCurrentTab]?.rag?.query_versions?.length > 0" class="mb-3 p-2 bg-yellow-50 rounded border border-yellow-200">
                                            <p class="text-xs font-semibold text-yellow-800 mb-2">ğŸ“ Queryæ”¹å†™ï¼ˆ3ä¸ªç‰ˆæœ¬ï¼‰</p>
                                            <div class="text-xs space-y-2">
                                                <div class="p-2 bg-white rounded">
                                                    <p class="text-gray-600 font-semibold mb-1">ğŸ”¹ åŸå§‹Query:</p>
                                                    <p class="text-gray-800 ml-2" x-text="chatDebugHistory[chatDebugCurrentTab]?.rag?.original_query"></p>
                                                </div>
                                                <template x-for="(qv, idx) in chatDebugHistory[chatDebugCurrentTab]?.rag?.query_versions || []" :key="idx">
                                                    <div class="p-2 bg-white rounded">
                                                        <p class="font-semibold mb-1" :class="{
                                                            'text-blue-600': idx === 0,
                                                            'text-green-600': idx === 1,
                                                            'text-purple-600': idx === 2
                                                        }">
                                                            <span x-text="`ğŸ”¹ ${qv.version}:`"></span>
                                                        </p>
                                                        <p class="ml-2" :class="{
                                                            'text-blue-700': idx === 0,
                                                            'text-green-700': idx === 1,
                                                            'text-purple-700': idx === 2
                                                        }" x-text="qv.query"></p>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        <!-- Two-Stage Retrieval Summary -->
                                        <div class="mb-3 p-2 bg-blue-50 rounded text-xs">
                                            <p class="font-semibold text-blue-800">ğŸ“Š ä¸¤é˜¶æ®µæ£€ç´¢ç»Ÿè®¡</p>
                                            <div class="mt-1 space-y-1">
                                                <p>ç²—æ’æ–¹æ³•: <span class="font-mono" x-text="chatDebugHistory[chatDebugCurrentTab]?.rag?.recall_method"></span></p>
                                                <p>ç²—æ’å¬å›: <strong x-text="chatDebugHistory[chatDebugCurrentTab]?.rag?.recall_count"></strong> ä¸ªå€™é€‰</p>
                                                <p>ç²¾æ’æ–¹æ³•: <span class="font-mono" x-text="chatDebugHistory[chatDebugCurrentTab]?.rag?.rerank_method"></span></p>
                                                <p>ç²¾æ’ç»“æœ: <strong x-text="chatDebugHistory[chatDebugCurrentTab]?.rag?.final_count"></strong> ä¸ªæœ€ç»ˆ</p>
                                            </div>
                                        </div>

                                        <!-- Final Results (Precision Stage) -->
                                        <p class="text-xs mb-2 font-semibold">ğŸ¯ ç²¾æ’Top-5ç»“æœ</p>
                                        <div class="space-y-2">
                                            <template x-for="(doc, idx) in chatDebugHistory[chatDebugCurrentTab]?.rag?.final_documents || []" :key="idx">
                                                <div class="bg-blue-50 p-2 rounded text-xs">
                                                    <div class="flex justify-between mb-1">
                                                        <span class="font-semibold text-blue-700">[<span x-text="idx + 1"></span>] <span x-text="doc.source?.type"></span>#<span x-text="doc.source?.id"></span></span>
                                                        <span class="text-blue-600">ç›¸å…³åº¦: <span x-text="doc.score.toFixed(2)"></span></span>
                                                    </div>
                                                    <p class="text-gray-600 whitespace-pre-wrap" x-text="doc.content"></p>
                                                </div>
                                            </template>
                                        </div>

                                        <!-- Recall Results (Coarse Stage) - Collapsible -->
                                        <details class="mt-3" x-data="{ open: false }">
                                            <summary class="cursor-pointer text-xs font-semibold text-gray-700 hover:text-gray-900">
                                                ğŸ“‹ ç²—æ’Top-20å€™é€‰ (ç‚¹å‡»å±•å¼€æŸ¥çœ‹è¯¦æƒ…)
                                            </summary>
                                            <div class="mt-2 space-y-2 max-h-96 overflow-y-auto">
                                                <template x-for="(doc, idx) in chatDebugHistory[chatDebugCurrentTab]?.rag?.recall_documents || []" :key="idx">
                                                    <div class="bg-gray-50 p-2 rounded text-xs border border-gray-200">
                                                        <div class="flex justify-between items-start mb-1">
                                                            <span class="font-semibold text-gray-700">[<span x-text="idx + 1"></span>] <span x-text="doc.metadata?.type"></span>#<span x-text="doc.metadata?.id"></span></span>
                                                            <div class="text-right">
                                                                <p class="text-gray-600">ç»¼åˆ: <span x-text="doc.score.toFixed(3)"></span></p>
                                                                <p class="text-blue-600 text-[10px]">å‘é‡: <span x-text="doc.vector_score?.toFixed(3) || 'N/A'"></span></p>
                                                                <p class="text-green-600 text-[10px]">BM25: <span x-text="doc.bm25_score?.toFixed(3) || 'N/A'"></span></p>
                                                            </div>
                                                        </div>
                                                        <p class="text-gray-600 text-[10px]" x-text="doc.content"></p>
                                                    </div>
                                                </template>
                                            </div>
                                        </details>
                                    </div>
                                    <p x-show="!chatDebugHistory[chatDebugCurrentTab]?.rag?.enabled" class="text-xs text-gray-500">RAGæœªå¯ç”¨</p>
                                </div>

                                <!-- å¯¹è¯å†å² -->
                                <div class="bg-white rounded-lg p-3 border border-green-200">
                                    <h4 class="font-semibold text-gray-700 mb-2">ğŸ’¬ ä¼šè¯è®°å¿†ï¼ˆå‘é€ç»™LLMçš„å†å²ï¼‰</h4>
                                    <p class="text-xs text-gray-600 mb-2">å†å²è½®æ•°: <strong x-text="chatDebugHistory[chatDebugCurrentTab]?.context?.history_length"></strong></p>
                                    <div class="space-y-2 max-h-96 overflow-y-auto">
                                        <template x-for="(msg, idx) in chatDebugHistory[chatDebugCurrentTab]?.context?.history || []" :key="idx">
                                            <div class="p-2 rounded text-xs"
                                                 :class="msg.role === 'user' ? 'bg-blue-50' : 'bg-green-50'"
                                                 x-data="{ expanded: false, lineCount: (msg.content.match(/\n/g) || []).length + 1 }">
                                                <p class="font-semibold mb-1"
                                                   :class="msg.role === 'user' ? 'text-blue-700' : 'text-green-700'"
                                                   x-text="msg.role === 'user' ? 'ğŸ‘¤ User' : 'ğŸ¤– Assistant'"></p>
                                                <p class="text-gray-700 whitespace-pre-wrap"
                                                   :class="!expanded && lineCount > 10 ? 'line-clamp-10' : ''"
                                                   x-text="msg.content"></p>
                                                <button x-show="lineCount > 10"
                                                        @click="expanded = !expanded"
                                                        class="mt-1 text-blue-600 hover:text-blue-800 text-xs"
                                                        x-text="expanded ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€ (å…±' + lineCount + 'è¡Œ)'"></button>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <!-- Base System Prompt -->
                                <div class="bg-white rounded-lg p-3 border border-purple-200"
                                     x-data="{
                                         expanded: false,
                                         get lineCount() {
                                             return chatDebugHistory[chatDebugCurrentTab]?.context?.base_system_prompt
                                                 ? (chatDebugInfo.context.base_system_prompt.match(/\n/g) || []).length + 1
                                                 : 0
                                         }
                                     }">
                                    <h4 class="font-semibold text-gray-700 mb-2">âš™ï¸ åŸºç¡€ System Prompt</h4>
                                    <pre class="text-xs bg-gray-50 p-2 rounded overflow-x-auto whitespace-pre-wrap"
                                         :class="!expanded && lineCount > 10 ? 'line-clamp-10' : ''"
                                         x-text="chatDebugHistory[chatDebugCurrentTab]?.context?.base_system_prompt"></pre>
                                    <button x-show="lineCount > 10"
                                            @click="expanded = !expanded"
                                            class="mt-1 text-purple-600 hover:text-purple-800 text-xs"
                                            x-text="expanded ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€ (å…±' + lineCount + 'è¡Œ)'"></button>
                                </div>

                                <!-- Current Round RAG Context -->
                                <div x-show="chatDebugHistory[chatDebugCurrentTab]?.context?.current_rag_context"
                                     class="bg-white rounded-lg p-3 border border-orange-200"
                                     x-data="{
                                         expanded: false,
                                         get lineCount() {
                                             return chatDebugHistory[chatDebugCurrentTab]?.context?.current_rag_context
                                                 ? (chatDebugInfo.context.current_rag_context.match(/\n/g) || []).length + 1
                                                 : 0
                                         }
                                     }">
                                    <h4 class="font-semibold text-gray-700 mb-2">ğŸ¯ æœ¬è½®RAGæ³¨å…¥å†…å®¹ï¼ˆä»…æœ¬æ¬¡å¯¹è¯ï¼‰</h4>
                                    <pre class="text-xs bg-orange-50 p-2 rounded overflow-x-auto whitespace-pre-wrap"
                                         :class="!expanded && lineCount > 10 ? 'line-clamp-10' : ''"
                                         x-text="chatDebugHistory[chatDebugCurrentTab]?.context?.current_rag_context"></pre>
                                    <button x-show="lineCount > 10"
                                            @click="expanded = !expanded"
                                            class="mt-1 text-orange-600 hover:text-orange-800 text-xs"
                                            x-text="expanded ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€ (å…±' + lineCount + 'è¡Œ)'"></button>
                                </div>
                            </div>
                        </details>
                    </div>

                    <!-- å¯¹è¯å†å²åŒºåŸŸ -->
                    <div class="flex-1 overflow-y-auto p-6 space-y-4" id="chatMessages">
                        <!-- æ¬¢è¿æ¶ˆæ¯ -->
                        <div x-show="chatMessages.length === 0" class="text-center py-12">
                            <div class="text-6xl mb-4">ğŸ¤–</div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">AIé¢è¯•åŠ©æ‰‹</h3>
                            <p class="text-gray-500">æˆ‘å¯ä»¥å¸®ä½ å›ç­”é¢è¯•ç›¸å…³çš„é—®é¢˜</p>
                            <p class="text-sm text-gray-400 mt-4">å»ºè®®é—®é¢˜ï¼š</p>
                            <div class="mt-3 space-y-2">
                                <button @click="chatInput = 'ä»€ä¹ˆæ˜¯RAGæŠ€æœ¯ï¼Ÿ'; sendChatMessage()"
                                        class="block mx-auto px-4 py-2 bg-gray-100 rounded-md text-sm hover:bg-gray-200">
                                    ä»€ä¹ˆæ˜¯RAGæŠ€æœ¯ï¼Ÿ
                                </button>
                                <button @click="chatInput = 'å¦‚ä½•å‡†å¤‡ç³»ç»Ÿè®¾è®¡é¢è¯•ï¼Ÿ'; sendChatMessage()"
                                        class="block mx-auto px-4 py-2 bg-gray-100 rounded-md text-sm hover:bg-gray-200">
                                    å¦‚ä½•å‡†å¤‡ç³»ç»Ÿè®¾è®¡é¢è¯•ï¼Ÿ
                                </button>
                            </div>
                        </div>

                        <!-- æ¶ˆæ¯åˆ—è¡¨ -->
                        <template x-for="(msg, index) in chatMessages" :key="index">
                            <div :class="msg.role === 'user' ? 'flex justify-end' : 'flex justify-start'">
                                <div :class="msg.role === 'user' ? 'bg-blue-50 text-gray-800 border border-blue-200' : 'bg-gray-100 text-gray-800'"
                                     class="max-w-3xl rounded-lg p-4">
                                    <!-- è§’è‰²æ ‡ç­¾ -->
                                    <div class="text-xs mb-2 opacity-75">
                                        <span x-text="msg.role === 'user' ? 'ğŸ‘¤ ä½ ' : 'ğŸ¤– AIåŠ©æ‰‹'"></span>
                                    </div>

                                    <!-- AIåŠ©æ‰‹æ­£åœ¨æ€è€ƒï¼ˆå†…å®¹ä¸ºç©ºæ—¶æ˜¾ç¤ºï¼‰ -->
                                    <div x-show="msg.role === 'assistant' && !msg.content" class="flex items-center space-x-2">
                                        <div class="animate-pulse">æ­£åœ¨æ€è€ƒ</div>
                                        <div class="flex space-x-1">
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                        </div>
                                    </div>

                                    <!-- æ¶ˆæ¯å†…å®¹ (Markdownæ¸²æŸ“) -->
                                    <div x-show="msg.content" class="prose prose-sm max-w-none"
                                         x-html="marked.parse(msg.content)">
                                    </div>

                                    <!-- æ—¶é—´æˆ³ -->
                                    <div class="text-xs mt-2 opacity-50"
                                         x-text="new Date(msg.timestamp).toLocaleTimeString()">
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- è¾“å…¥åŒºåŸŸ -->
                    <div class="border-t p-4">
                        <div class="flex items-end space-x-3">
                            <textarea
                                x-model="chatInput"
                                @keydown.enter.ctrl="sendChatMessage()"
                                placeholder="è¾“å…¥ä½ çš„é—®é¢˜... (Ctrl+Enter å‘é€)"
                                rows="3"
                                class="flex-1 border rounded-md px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
                                :disabled="chatStreaming"
                            ></textarea>
                            <button
                                @click="sendChatMessage()"
                                :disabled="!chatInput.trim() || chatStreaming"
                                class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed h-[76px] flex items-center justify-center">
                                <span x-show="!chatStreaming">å‘é€ â†’</span>
                                <span x-show="chatStreaming">
                                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                </span>
                            </button>
                        </div>
                        <div class="mt-2 text-xs text-gray-500">
                            æç¤ºï¼šCtrl+Enter å¿«é€Ÿå‘é€ | æ”¯æŒMarkdownæ ¼å¼
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <!-- åŸå§‹é—®é¢˜ç®¡ç† -->
            <div x-show="currentTab === 'source'" x-cloak>
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">æ·»åŠ åŸå§‹é—®é¢˜</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¥æºæ ‡é¢˜</label>
                            <input x-model="newSource.source_title"
                                   type="text"
                                   class="w-full border rounded-md px-3 py-2"
                                   placeholder="ä¾‹å¦‚ï¼šé˜¿é‡Œäº‘Agentç®—æ³•ä¸€é¢">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">åŸå§‹é—®é¢˜æ–‡æœ¬</label>
                            <textarea x-model="newSource.original_text"
                                      rows="4"
                                      class="w-full border rounded-md px-3 py-2"
                                      placeholder="ç²˜è´´é¢ç»ä¸­çš„åŸå§‹é—®é¢˜æ–‡æœ¬..."></textarea>
                        </div>
                        <button @click="addSourceQuestion()"
                                :disabled="!newSource.original_text"
                                class="w-full bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700 disabled:bg-gray-400">
                            â• æ·»åŠ åŸå§‹é—®é¢˜
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">åŸå§‹é—®é¢˜åˆ—è¡¨</h2>
                        <button @click="loadSourceQuestions()" class="text-blue-600 hover:text-blue-700">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </div>
                    <div class="space-y-4">
                        <template x-for="source in sourceQuestions" :key="source.id">
                            <div class="border rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium" x-text="source.source_title"></h3>
                                    <span :class="source.is_extracted ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                                          class="px-2 py-1 text-xs rounded-full">
                                        <span x-text="source.is_extracted ? 'å·²æå–' : 'æœªæå–'"></span>
                                        <span x-show="source.is_extracted" x-text="'(' + source.detail_count + 'é¢˜)'"></span>
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3" x-text="source.original_text.substring(0, 200) + '...'"></p>
                                <div class="flex space-x-2">
                                    <button @click="extractQuestions(source.id)"
                                            x-show="!source.is_extracted"
                                            :disabled="extractingSourceId === source.id"
                                            class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:bg-gray-400">
                                        <span x-show="extractingSourceId !== source.id">ğŸ” æå–é—®é¢˜</span>
                                        <span x-show="extractingSourceId === source.id">ğŸ”„ æå–ä¸­...</span>
                                    </button>
                                    <button @click="deleteSource(source.id)"
                                            class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- æ˜ç»†é—®é¢˜æŸ¥çœ‹ -->
            <div x-show="currentTab === 'questions'" x-cloak>
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">ç­›é€‰æ¡ä»¶</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <select x-model="questionFilter.domain" @change="loadQuestions()" class="border rounded-md px-3 py-2">
                            <option value="">å…¨éƒ¨é¢†åŸŸ</option>
                            <option>å¤§æ¨¡å‹</option>
                            <option>RAG</option>
                            <option>è®°å¿†ç®¡ç†</option>
                            <option>Langchainè¯­æ³•</option>
                            <option>æ™ºèƒ½ä½“æ¡†æ¶</option>
                            <option>æ•ˆæœè¯„æµ‹</option>
                            <option>å·¥ç¨‹åŒ–éƒ¨ç½²å®è·µ</option>
                            <option>å…¶ä»–</option>
                        </select>
                        <select x-model="questionFilter.has_answer" @change="loadQuestions()" class="border rounded-md px-3 py-2">
                            <option value="">å…¨éƒ¨</option>
                            <option value="true">æœ‰ç­”æ¡ˆ</option>
                            <option value="false">æ— ç­”æ¡ˆ</option>
                        </select>
                        <select x-model="questionFilter.mastery_level" @change="loadQuestions()" class="border rounded-md px-3 py-2">
                            <option value="">å…¨éƒ¨æŒæ¡ç¨‹åº¦</option>
                            <option value="ä¸ä¼š">ä¸ä¼š</option>
                            <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
                            <option value="ä¼šäº†">ä¼šäº†</option>
                        </select>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">
                            æ˜ç»†é—®é¢˜åˆ—è¡¨
                            <span class="text-sm text-gray-500">ï¼ˆå…± <span x-text="detailQuestions.length"></span> é¢˜ï¼‰</span>
                        </h2>
                    </div>
                    <div class="space-y-4">
                        <template x-for="q in detailQuestions" :key="q.id">
                            <div class="border rounded-lg p-4">
                                <div class="flex items-start justify-between mb-2">
                                    <h3 class="font-medium flex-1 whitespace-pre-wrap" x-text="q.refined_question || q.question"></h3>
                                    <div class="flex space-x-2 ml-4">
                                        <span x-show="q.domain"
                                              class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"
                                              x-text="q.domain"></span>
                                        <span x-show="q.latest_mastery_level"
                                              :class="{
                                                  'ä¸ä¼š': 'bg-red-100 text-red-800',
                                                  'ä¸€èˆ¬': 'bg-yellow-100 text-yellow-800',
                                                  'ä¼šäº†': 'bg-green-100 text-green-800'
                                              }[q.latest_mastery_level]"
                                              class="px-2 py-1 text-xs rounded-full"
                                              x-text="q.latest_mastery_level"></span>
                                    </div>
                                </div>
                                <details x-show="q.has_answer">
                                    <summary class="cursor-pointer text-sm text-blue-600 mb-2">æŸ¥çœ‹ç­”æ¡ˆ</summary>
                                    <div class="mt-2 p-3 bg-gray-50 rounded text-sm">
                                        <div class="flex justify-between items-start mb-2">
                                            <p class="whitespace-pre-wrap flex-1" x-text="q.answer"></p>
                                            <button @click="openEditAnswer(q)"
                                                    class="ml-2 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">
                                                âœï¸ ç¼–è¾‘
                                            </button>
                                        </div>
                                        <p class="text-xs text-gray-500">
                                            <strong>å…³é”®è¯:</strong> <span x-text="q.keywords"></span>
                                        </p>
                                        <p class="text-xs text-gray-500 mt-1">
                                            <strong>é¢†åŸŸ:</strong> <span x-text="q.domain || 'æœªåˆ†ç±»'"></span>
                                        </p>
                                    </div>
                                </details>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- ç¼–è¾‘ç­”æ¡ˆæ¨¡æ€æ¡† -->
                <div x-show="showEditAnswerModal"
                     x-cloak
                     @click.self="showEditAnswerModal = false"
                     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                        <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
                        <div class="flex justify-between items-center p-6 border-b">
                            <h3 class="text-xl font-semibold">ç¼–è¾‘ç­”æ¡ˆ</h3>
                            <button @click="showEditAnswerModal = false"
                                    class="text-gray-500 hover:text-gray-700 text-2xl">
                                Ã—
                            </button>
                        </div>

                        <!-- æ¨¡æ€æ¡†å†…å®¹ -->
                        <div class="flex-1 overflow-y-auto p-6 space-y-4">
                            <!-- é—®é¢˜æ˜¾ç¤º -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm font-semibold text-blue-900 mb-2">é—®é¢˜</p>
                                <p class="whitespace-pre-wrap" x-text="editingQuestion?.refined_question || editingQuestion?.question"></p>
                            </div>

                            <!-- ç­”æ¡ˆç¼–è¾‘ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç­”æ¡ˆå†…å®¹ *</label>
                                <textarea x-model="editAnswer.answer"
                                          rows="12"
                                          class="w-full border rounded-md px-3 py-2 font-mono text-sm"
                                          placeholder="è¾“å…¥ç­”æ¡ˆå†…å®¹..."></textarea>
                            </div>

                            <!-- å…³é”®è¯ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å…³é”®è¯</label>
                                <input type="text"
                                       x-model="editAnswer.keywords"
                                       class="w-full border rounded-md px-3 py-2"
                                       placeholder="ç”¨é€—å·åˆ†éš”å…³é”®è¯">
                            </div>

                            <!-- é¢†åŸŸ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é¢†åŸŸ</label>
                                <select x-model="editAnswer.domain" class="w-full border rounded-md px-3 py-2">
                                    <option value="">æœªåˆ†ç±»</option>
                                    <option value="å¤§æ¨¡å‹">å¤§æ¨¡å‹</option>
                                    <option value="RAG">RAG</option>
                                    <option value="è®°å¿†ç®¡ç†">è®°å¿†ç®¡ç†</option>
                                    <option value="Langchainè¯­æ³•">Langchainè¯­æ³•</option>
                                    <option value="æ™ºèƒ½ä½“æ¡†æ¶">æ™ºèƒ½ä½“æ¡†æ¶</option>
                                    <option value="æ•ˆæœè¯„æµ‹">æ•ˆæœè¯„æµ‹</option>
                                    <option value="å·¥ç¨‹åŒ–éƒ¨ç½²å®è·µ">å·¥ç¨‹åŒ–éƒ¨ç½²å®è·µ</option>
                                    <option value="å…¶ä»–">å…¶ä»–</option>
                                </select>
                            </div>
                        </div>

                        <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
                        <div class="flex justify-end space-x-3 p-6 border-t">
                            <button @click="showEditAnswerModal = false"
                                    class="px-4 py-2 border rounded-md hover:bg-gray-50">
                                å–æ¶ˆ
                            </button>
                            <button @click="saveAnswer()"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                ğŸ’¾ ä¿å­˜
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¬”è®°ç®¡ç† -->
            <div x-show="currentTab === 'notes'" x-cloak>
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">ğŸ“ æ·»åŠ æ–°ç¬”è®°</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">ç¬”è®°æ ‡é¢˜</label>
                            <input type="text" x-model="newNote.title" placeholder="è¾“å…¥ç¬”è®°æ ‡é¢˜"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">ç¬”è®°ç±»å‹</label>
                            <select x-model="newNote.note_type" class="border rounded-md px-3 py-2">
                                <option value="å¿ƒå¾—">å¿ƒå¾—</option>
                                <option value="é¢è¯•è®°å½•">é¢è¯•è®°å½•</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">ç¬”è®°å†…å®¹ï¼ˆå¯ç²˜è´´é¢è¯•å½•éŸ³è½¬æ–‡æœ¬ï¼‰</label>
                            <textarea x-model="newNote.content" rows="8" placeholder="è¾“å…¥æˆ–ç²˜è´´ç¬”è®°å†…å®¹"
                                      class="w-full border rounded-md px-3 py-2"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                            <input type="text" x-model="newNote.tags" placeholder="ä¾‹å¦‚: Python,ç®—æ³•,ç³»ç»Ÿè®¾è®¡"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <button @click="addNote()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700">
                            ä¿å­˜ç¬”è®°
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">
                            ç¬”è®°åˆ—è¡¨
                            <span class="text-sm text-gray-500">ï¼ˆå…± <span x-text="notes.length"></span> ç¯‡ï¼‰</span>
                        </h2>
                        <div class="flex items-center space-x-2">
                            <input type="text"
                                   x-model="noteSearchQuery"
                                   @input="searchNotes()"
                                   placeholder="æœç´¢æ ‡é¢˜æˆ–å†…å®¹..."
                                   class="border rounded-md px-3 py-1 text-sm w-64">
                            <button @click="noteSearchQuery=''; searchNotes()"
                                    class="text-gray-500 hover:text-gray-700">
                                æ¸…é™¤
                            </button>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <template x-for="note in notes" :key="note.id">
                            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium text-lg" x-text="note.title"></h3>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full"
                                              x-text="note.note_type"></span>
                                        <button @click="viewNoteDetail(note)"
                                                class="text-blue-600 text-sm hover:underline">
                                            æŸ¥çœ‹è¯¦æƒ…
                                        </button>
                                        <button @click="deleteNote(note.id)"
                                                class="text-red-600 text-sm hover:underline">
                                            åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                                <!-- æ‘˜è¦æ˜¾ç¤ºï¼ˆå‰150ä¸ªå­—ç¬¦ï¼‰ -->
                                <p class="text-gray-600 mb-2"
                                   x-text="note.content.length > 150 ? note.content.substring(0, 150) + '...' : note.content">
                                </p>
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span x-show="note.tags">æ ‡ç­¾: <span x-text="note.tags"></span></span>
                                    <span x-text="new Date(note.created_at).toLocaleString()"></span>
                                </div>
                            </div>
                        </template>
                        <div x-show="notes.length === 0" class="text-center text-gray-500 py-8">
                            æš‚æ— ç¬”è®°
                        </div>
                    </div>
                </div>

                <!-- ç¬”è®°è¯¦æƒ…æ¨¡æ€æ¡† -->
                <div x-show="showNoteModal"
                     x-cloak
                     @click.self="showNoteModal = false"
                     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                        <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
                        <div class="flex justify-between items-center p-6 border-b">
                            <h3 class="text-xl font-semibold" x-text="currentNote?.title"></h3>
                            <button @click="showNoteModal = false"
                                    class="text-gray-500 hover:text-gray-700 text-2xl">
                                Ã—
                            </button>
                        </div>

                        <!-- æ¨¡æ€æ¡†å†…å®¹ï¼ˆMarkdownæ¸²æŸ“ï¼‰ -->
                        <div class="flex-1 overflow-y-auto p-6">
                            <div class="mb-4 flex items-center space-x-3 text-sm text-gray-600">
                                <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full"
                                      x-text="currentNote?.note_type"></span>
                                <span x-show="currentNote?.tags">
                                    æ ‡ç­¾: <span x-text="currentNote?.tags"></span>
                                </span>
                                <span x-text="currentNote?.created_at ? new Date(currentNote.created_at).toLocaleString() : ''"></span>
                            </div>

                            <!-- Markdownæ¸²æŸ“å†…å®¹ -->
                            <div class="prose max-w-none"
                                 x-html="currentNote?.content ? marked.parse(currentNote.content) : ''">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é¢è¯•æ—¥ç¨‹ -->
            <div x-show="currentTab === 'schedules'">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">ğŸ“… æ·»åŠ é¢è¯•æ—¥ç¨‹</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">å…¬å¸åç§°</label>
                            <input type="text" x-model="newSchedule.company_name"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å²—ä½åç§°</label>
                            <input type="text" x-model="newSchedule.position_name"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">é¢è¯•æ—¶é—´</label>
                            <input type="datetime-local" x-model="newSchedule.interview_time"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">é¢è¯•ç±»å‹</label>
                            <select x-model="newSchedule.interview_type" class="w-full border rounded-md px-3 py-2">
                                <option value="è§†é¢‘é¢è¯•">è§†é¢‘é¢è¯•</option>
                                <option value="ç”µè¯é¢è¯•">ç”µè¯é¢è¯•</option>
                                <option value="ç°åœºé¢è¯•">ç°åœºé¢è¯•</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-2">åœ°ç‚¹/é“¾æ¥</label>
                            <input type="text" x-model="newSchedule.location"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-2">å¤‡æ³¨</label>
                            <textarea x-model="newSchedule.notes" rows="2"
                                      class="w-full border rounded-md px-3 py-2"></textarea>
                        </div>
                    </div>
                    <button @click="addSchedule()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700">
                        æ·»åŠ æ—¥ç¨‹
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">é¢è¯•æ—¥ç¨‹åˆ—è¡¨</h2>
                    <div class="space-y-4">
                        <template x-for="schedule in schedules" :key="schedule.id">
                            <div class="border rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h3 class="font-medium text-lg">
                                            <span x-text="schedule.company_name"></span> - <span x-text="schedule.position_name"></span>
                                        </h3>
                                        <p class="text-gray-600 text-sm mt-1">
                                            ğŸ•’ <span x-text="new Date(schedule.interview_time).toLocaleString()"></span>
                                        </p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span :class="{
                                            'å¾…é¢è¯•': 'bg-yellow-100 text-yellow-800',
                                            'å·²å®Œæˆ': 'bg-green-100 text-green-800',
                                            'å·²å–æ¶ˆ': 'bg-gray-100 text-gray-800'
                                        }[schedule.status]" class="px-2 py-1 text-xs rounded-full" x-text="schedule.status"></span>
                                        <button @click="deleteSchedule(schedule.id)" class="text-red-600 text-sm hover:underline">åˆ é™¤</button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-600" x-show="schedule.interview_type">
                                    ç±»å‹: <span x-text="schedule.interview_type"></span>
                                </p>
                                <p class="text-sm text-gray-600" x-show="schedule.location">
                                    åœ°ç‚¹: <span x-text="schedule.location"></span>
                                </p>
                                <p class="text-sm text-gray-600 mt-1" x-show="schedule.notes" x-text="schedule.notes"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- å²—ä½åˆ†æ -->
            <div x-show="currentTab === 'job-analysis'">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">ğŸ’¼ å²—ä½åˆ†æä¸é¢è¯•å‡†å¤‡è®¡åˆ’</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">å²—ä½åç§°</label>
                            <input type="text" x-model="newJobAnalysis.job_title" placeholder="ä¾‹å¦‚: é«˜çº§AIå·¥ç¨‹å¸ˆ"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å…¬å¸åç§°ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" x-model="newJobAnalysis.company_name" placeholder="ä¾‹å¦‚: é˜¿é‡Œå·´å·´"
                                   class="w-full border rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å²—ä½JD</label>
                            <textarea x-model="newJobAnalysis.jd_content" rows="10" placeholder="ç²˜è´´å®Œæ•´çš„å²—ä½æè¿°..."
                                      class="w-full border rounded-md px-3 py-2"></textarea>
                        </div>
                        <!-- åˆ†ç¦»ä¿å­˜å’ŒAIåˆ†æ -->
                        <div class="flex space-x-3">
                            <button @click="saveJobAnalysis(false)" :disabled="analyzingJob"
                                    class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 disabled:bg-gray-400">
                                ğŸ’¾ ä¿å­˜
                            </button>
                            <button @click="saveJobAnalysis(true)" :disabled="analyzingJob"
                                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                                <span x-show="!analyzingJob">ğŸ” ä¿å­˜å¹¶AIåˆ†æ</span>
                                <span x-show="analyzingJob">ğŸ”„ åˆ†æä¸­...</span>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            ğŸ’¡ æç¤ºï¼šå¯ä»¥å…ˆå¿«é€Ÿä¿å­˜ï¼Œç¨åå†è§¦å‘AIåˆ†æ
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">å†å²åˆ†æè®°å½•</h2>
                        <button @click="loadJobAnalyses()" class="text-sm text-blue-600 hover:underline">
                            ğŸ”„ åˆ·æ–°çŠ¶æ€
                        </button>
                    </div>
                    <div class="space-y-4">
                        <template x-for="analysis in jobAnalyses" :key="analysis.id">
                            <div class="border rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <h3 class="font-medium text-lg">
                                            <span x-text="analysis.job_title"></span>
                                            <span x-show="analysis.company_name" class="text-gray-500" x-text="'@ ' + analysis.company_name"></span>
                                        </h3>
                                        <!-- çŠ¶æ€æ ‡ç­¾ -->
                                        <div class="mt-2">
                                            <span x-show="analysis.analysis_status === 'pending'"
                                                  class="inline-block px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded">
                                                â³ æœªåˆ†æ
                                            </span>
                                            <span x-show="analysis.analysis_status === 'processing'"
                                                  class="inline-block px-2 py-1 text-xs bg-blue-200 text-blue-700 rounded">
                                                ğŸ”„ åˆ†æä¸­...
                                            </span>
                                            <span x-show="analysis.analysis_status === 'completed'"
                                                  class="inline-block px-2 py-1 text-xs bg-green-200 text-green-700 rounded">
                                                âœ… å·²å®Œæˆ
                                            </span>
                                            <span x-show="analysis.analysis_status === 'failed'"
                                                  class="inline-block px-2 py-1 text-xs bg-red-200 text-red-700 rounded">
                                                âŒ åˆ†æå¤±è´¥
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <!-- åªæœ‰æœªåˆ†ææˆ–å¤±è´¥çŠ¶æ€æ—¶æ˜¾ç¤ºåˆ†ææŒ‰é’® -->
                                        <button x-show="analysis.analysis_status === 'pending' || analysis.analysis_status === 'failed'"
                                                @click="triggerAnalysis(analysis.id)"
                                                class="text-blue-600 text-sm hover:underline">
                                            ğŸ” åˆ†æ
                                        </button>
                                        <button @click="deleteJobAnalysis(analysis.id)"
                                                class="text-red-600 text-sm hover:underline">
                                            åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                                <!-- åªæœ‰å·²å®ŒæˆçŠ¶æ€æ‰æ˜¾ç¤ºè¯¦æƒ… -->
                                <details x-show="analysis.analysis_status === 'completed'">
                                    <summary class="cursor-pointer text-sm text-blue-600 mb-2">æŸ¥çœ‹é¢è¯•å‡†å¤‡è®¡åˆ’</summary>
                                    <div class="mt-2 p-3 bg-gray-50 rounded text-sm prose prose-sm max-w-none"
                                         x-html="analysis.analysis_result ? marked.parse(analysis.analysis_result) : ''">
                                    </div>
                                </details>
                                <p class="text-xs text-gray-500 mt-2" x-text="new Date(analysis.created_at).toLocaleString()"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

        </main>

        <!-- è®¾ç½®å¼¹çª— -->
        <div x-show="showSettings" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showSettings = false">
            <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
                <h2 class="text-xl font-bold mb-4">âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">åç«¯æœåŠ¡å™¨IPåœ°å€</label>
                    <input type="text" x-model="settingsApiHost" placeholder="ä¾‹å¦‚: 192.168.1.100" class="w-full border rounded-md px-3 py-2">
                    <p class="text-xs text-gray-500 mt-1">ç•™ç©ºåˆ™è‡ªåŠ¨ä½¿ç”¨å½“å‰åœ°å€</p>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-md p-3 mb-4">
                    <p class="text-sm text-blue-900 font-medium mb-2">ğŸ“± æ‰‹æœºè®¿é—®æ­¥éª¤ï¼š</p>
                    <ol class="text-xs text-blue-800 space-y-1 list-decimal list-inside">
                        <li>ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€WiFi</li>
                        <li>åŒå‡» get_ip.bat æŸ¥çœ‹ç”µè„‘IP</li>
                        <li>åœ¨æ­¤å¡«å…¥ç”µè„‘IPå¹¶ä¿å­˜</li>
                        <li>æ‰‹æœºæµè§ˆå™¨è®¿é—®: http://ç”µè„‘IP:3000</li>
                    </ol>
                </div>
                <div class="flex justify-end space-x-3">
                    <button @click="showSettings = false" class="px-4 py-2 border rounded-md text-gray-700 hover:bg-gray-50">å–æ¶ˆ</button>
                    <button @click="saveSettings()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">ä¿å­˜å¹¶åˆ·æ–°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä» localStorage è¯»å– API åœ°å€ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨å½“å‰ä¸»æœºå
        function getApiBase() {
            const savedHost = localStorage.getItem('apiHost');
            if (savedHost) {
                return `http://${savedHost}:8000/api`;
            }
            // é»˜è®¤ä½¿ç”¨å½“å‰æµè§ˆå™¨çš„ä¸»æœºåï¼ˆæ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼‰
            const hostname = window.location.hostname || 'localhost';
            return `http://${hostname}:8000/api`;
        }
        const API_BASE = getApiBase();

        function app() {
            return {
                currentTab: 'practice',
                stats: {},
                practiceFilter: { domain: '', mastery_level: '' },
                questionFilter: { domain: '', has_answer: '', mastery_level: '' },
                currentQuestion: null,
                userAnswer: '',
                mastery: null,
                scoreResult: null,
                markedOnly: false,
                sourceQuestions: [],
                detailQuestions: [],
                newSource: { source_title: '', original_text: '' },
                showSettings: false,
                // ç¼–è¾‘ç­”æ¡ˆç›¸å…³
                showEditAnswerModal: false,
                editingQuestion: null,
                editAnswer: { answer: '', keywords: '', domain: '' },
                settingsApiHost: localStorage.getItem('apiHost') || '',
                // æ–°å¢æ¨¡å—æ•°æ®
                notes: [],
                newNote: { title: '', content: '', note_type: 'å¿ƒå¾—', tags: '' },
                noteSearchQuery: '',
                showNoteModal: false,
                currentNote: null,
                // Chatbotæ•°æ® - å¤šä¼šè¯ç®¡ç†
                chatSessions: [],  // æ‰€æœ‰ä¼šè¯åˆ—è¡¨
                currentChatSessionIndex: -1,  // å½“å‰ä¼šè¯ç´¢å¼•ï¼ˆ-1è¡¨ç¤ºæ— ä¼šè¯ï¼‰
                chatInput: '',
                chatModel: 'qwen-turbo',  // é»˜è®¤æ¨¡å‹ï¼šqwen-turbo (æè‡´é€Ÿåº¦)
                chatUseRag: true,
                chatEnableSearch: false,  // è”ç½‘æœç´¢å¼€å…³
                chatDevMode: true,  // å¼€å‘è€…æ¨¡å¼ï¼ˆé»˜è®¤å¼€å¯ï¼‰
                chatStreaming: false,
                schedules: [],
                upcomingInterviews: [],
                newSchedule: { company_name: '', position_name: '', interview_time: '', interview_type: 'è§†é¢‘é¢è¯•', location: '', notes: '', status: 'å¾…é¢è¯•' },
                jobAnalyses: [],
                newJobAnalysis: { job_title: '', company_name: '', jd_content: '' },
                analyzingJob: false,
                // LoadingçŠ¶æ€
                submittingAnswer: false,
                extractingSourceId: null,

                // è®¡ç®—å±æ€§ï¼šå½“å‰ä¼šè¯
                get currentSession() {
                    return this.currentChatSessionIndex >= 0 ? this.chatSessions[this.currentChatSessionIndex] : null;
                },
                get chatMessages() {
                    return this.currentSession?.messages || [];
                },
                get chatDebugHistory() {
                    return this.currentSession?.debugHistory || [];
                },
                get chatDebugCurrentTab() {
                    return this.currentSession?.debugCurrentTab || 0;
                },
                set chatDebugCurrentTab(value) {
                    if (this.currentSession) {
                        this.currentSession.debugCurrentTab = value;
                    }
                },

                async init() {
                    await this.loadStatistics();
                    await this.loadSourceQuestions();
                    await this.loadQuestions();
                    await this.loadNotes();
                    await this.loadSchedules();
                    await this.loadUpcomingInterviews();
                    await this.loadJobAnalyses();
                    // åˆå§‹åŒ–ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªä¼šè¯
                    this.startNewChat();
                },

                saveSettings() {
                    if (this.settingsApiHost.trim()) {
                        localStorage.setItem('apiHost', this.settingsApiHost.trim());
                    } else {
                        localStorage.removeItem('apiHost');
                    }
                    location.reload();
                },

                async loadStatistics() {
                    try {
                        const res = await fetch(`${API_BASE}/questions/statistics/overview`);
                        this.stats = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
                    }
                },

                async getRandomQuestion() {
                    try {
                        let url = `${API_BASE}/questions/random?`;
                        if (this.practiceFilter.domain) url += `domain=${this.practiceFilter.domain}&`;
                        if (this.practiceFilter.mastery_level && this.practiceFilter.mastery_level !== 'NULL') {
                            url += `mastery_level=${this.practiceFilter.mastery_level}`;
                        }

                        const res = await fetch(url);
                        if (res.ok) {
                            this.currentQuestion = await res.json();
                            this.userAnswer = '';
                            this.mastery = null;
                            this.scoreResult = null;
                            this.markedOnly = false;
                        } else {
                            alert('æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„é—®é¢˜');
                        }
                    } catch (error) {
                        alert('è·å–é—®é¢˜å¤±è´¥: ' + error.message);
                    }
                },

                async submitAnswer() {
                    if (!this.userAnswer || !this.mastery) {
                        alert('è¯·å¡«å†™å›ç­”å¹¶é€‰æ‹©æŒæ¡ç¨‹åº¦');
                        return;
                    }

                    this.submittingAnswer = true;
                    try {
                        const res = await fetch(`${API_BASE}/practice/submit`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                question_id: this.currentQuestion.id,
                                user_answer: this.userAnswer,
                                mastery_level: this.mastery
                            })
                        });

                        if (res.ok) {
                            this.scoreResult = await res.json();
                            await this.loadStatistics();
                        } else {
                            alert('æäº¤å¤±è´¥');
                        }
                    } catch (error) {
                        alert('æäº¤å¤±è´¥: ' + error.message);
                    } finally {
                        this.submittingAnswer = false;
                    }
                },

                async markOnly() {
                    if (!this.mastery) {
                        alert('è¯·é€‰æ‹©æŒæ¡ç¨‹åº¦');
                        return;
                    }

                    try {
                        const res = await fetch(`${API_BASE}/practice/mark-mastery?question_id=${this.currentQuestion.id}&mastery_level=${this.mastery}`, {
                            method: 'POST'
                        });

                        if (res.ok) {
                            this.markedOnly = true;
                            await this.loadStatistics();
                        } else {
                            alert('æ ‡è®°å¤±è´¥');
                        }
                    } catch (error) {
                        alert('æ ‡è®°å¤±è´¥: ' + error.message);
                    }
                },

                async loadSourceQuestions() {
                    try {
                        const res = await fetch(`${API_BASE}/source/`);
                        this.sourceQuestions = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½åŸå§‹é—®é¢˜å¤±è´¥:', error);
                    }
                },

                openEditAnswer(question) {
                    this.editingQuestion = question;
                    this.editAnswer = {
                        answer: question.answer || '',
                        keywords: question.keywords || '',
                        domain: question.domain || ''
                    };
                    this.showEditAnswerModal = true;
                },

                async saveAnswer() {
                    if (!this.editAnswer.answer.trim()) {
                        alert('è¯·è¾“å…¥ç­”æ¡ˆå†…å®¹');
                        return;
                    }

                    try {
                        const res = await fetch(`${API_BASE}/questions/${this.editingQuestion.id}/answer`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.editAnswer)
                        });

                        if (res.ok) {
                            const updated = await res.json();
                            // æ›´æ–°åˆ—è¡¨ä¸­çš„é—®é¢˜
                            const index = this.detailQuestions.findIndex(q => q.id === updated.id);
                            if (index !== -1) {
                                this.detailQuestions[index] = updated;
                            }
                            alert('ç­”æ¡ˆä¿å­˜æˆåŠŸï¼');
                            this.showEditAnswerModal = false;
                            await this.loadQuestions();
                            await this.loadStatistics();
                        } else {
                            const error = await res.json();
                            alert('ä¿å­˜å¤±è´¥: ' + (error.detail || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    }
                },

                async addSourceQuestion() {
                    if (!this.newSource.original_text) {
                        alert('è¯·è¾“å…¥åŸå§‹é—®é¢˜æ–‡æœ¬');
                        return;
                    }

                    try {
                        const res = await fetch(`${API_BASE}/source/`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newSource)
                        });

                        if (res.ok) {
                            alert('æ·»åŠ æˆåŠŸï¼');
                            this.newSource = { source_title: '', original_text: '' };
                            await this.loadSourceQuestions();
                        } else {
                            const error = await res.json();
                            alert('æ·»åŠ å¤±è´¥: ' + error.detail);
                        }
                    } catch (error) {
                        alert('æ·»åŠ å¤±è´¥: ' + error.message);
                    }
                },

                async extractQuestions(sourceId) {
                    if (!confirm('ç¡®å®šè¦æå–è¿™ä¸ªåŸå§‹é—®é¢˜çš„æ˜ç»†é—®é¢˜å—ï¼Ÿ')) return;

                    this.extractingSourceId = sourceId;
                    try {
                        const res = await fetch(`${API_BASE}/source/${sourceId}/extract`, {
                            method: 'POST'
                        });

                        if (res.ok) {
                            const result = await res.json();
                            alert(`æå–æˆåŠŸï¼è¯†åˆ«åˆ° ${result.total_identified} ä¸ªé—®é¢˜ï¼ŒæˆåŠŸä¿å­˜ ${result.detail_count} ä¸ª`);
                            await this.loadSourceQuestions();
                            await this.loadQuestions();
                            await this.loadStatistics();
                        } else {
                            const error = await res.json();
                            alert('æå–å¤±è´¥: ' + error.detail);
                        }
                    } catch (error) {
                        alert('æå–å¤±è´¥: ' + error.message);
                    } finally {
                        this.extractingSourceId = null;
                    }
                },

                async deleteSource(sourceId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåŸå§‹é—®é¢˜å—ï¼Ÿ')) return;

                    try {
                        const res = await fetch(`${API_BASE}/source/${sourceId}`, {
                            method: 'DELETE'
                        });

                        if (res.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            await this.loadSourceQuestions();
                        } else {
                            alert('åˆ é™¤å¤±è´¥');
                        }
                    } catch (error) {
                        alert('åˆ é™¤å¤±è´¥: ' + error.message);
                    }
                },

                async loadQuestions() {
                    try {
                        let url = `${API_BASE}/questions/?limit=200`;
                        if (this.questionFilter.domain) url += `&domain=${this.questionFilter.domain}`;
                        if (this.questionFilter.has_answer) url += `&has_answer=${this.questionFilter.has_answer}`;
                        if (this.questionFilter.mastery_level) url += `&mastery_level=${this.questionFilter.mastery_level}`;

                        const res = await fetch(url);
                        this.detailQuestions = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½æ˜ç»†é—®é¢˜å¤±è´¥:', error);
                    }
                },

                // ========== ç¬”è®°ç®¡ç† ==========
                async loadNotes() {
                    try {
                        let url = `${API_BASE}/notes/`;
                        if (this.noteSearchQuery.trim()) {
                            url += `?search=${encodeURIComponent(this.noteSearchQuery.trim())}`;
                        }
                        const res = await fetch(url);
                        this.notes = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½ç¬”è®°å¤±è´¥:', error);
                    }
                },

                async searchNotes() {
                    await this.loadNotes();
                },

                viewNoteDetail(note) {
                    this.currentNote = note;
                    this.showNoteModal = true;
                },

                async addNote() {
                    if (!this.newNote.title || !this.newNote.content) {
                        alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
                        return;
                    }

                    try {
                        const res = await fetch(`${API_BASE}/notes/`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newNote)
                        });

                        if (res.ok) {
                            alert('ä¿å­˜æˆåŠŸï¼');
                            this.newNote = { title: '', content: '', note_type: 'å¿ƒå¾—', tags: '' };
                            await this.loadNotes();
                        } else {
                            alert('ä¿å­˜å¤±è´¥');
                        }
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    }
                },

                async deleteNote(noteId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡ç¬”è®°å—ï¼Ÿ')) return;

                    try {
                        const res = await fetch(`${API_BASE}/notes/${noteId}`, { method: 'DELETE' });
                        if (res.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            await this.loadNotes();
                        }
                    } catch (error) {
                        alert('åˆ é™¤å¤±è´¥: ' + error.message);
                    }
                },

                // ========== é¢è¯•æ—¥ç¨‹ç®¡ç† ==========
                async loadSchedules() {
                    try {
                        const res = await fetch(`${API_BASE}/schedules/`);
                        this.schedules = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½é¢è¯•æ—¥ç¨‹å¤±è´¥:', error);
                    }
                },

                async loadUpcomingInterviews() {
                    try {
                        const res = await fetch(`${API_BASE}/schedules/upcoming?days=7`);
                        this.upcomingInterviews = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½å³å°†åˆ°æ¥çš„é¢è¯•å¤±è´¥:', error);
                    }
                },

                async addSchedule() {
                    if (!this.newSchedule.company_name || !this.newSchedule.position_name || !this.newSchedule.interview_time) {
                        alert('è¯·å¡«å†™å…¬å¸åç§°ã€å²—ä½åç§°å’Œé¢è¯•æ—¶é—´');
                        return;
                    }

                    try {
                        const res = await fetch(`${API_BASE}/schedules/`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newSchedule)
                        });

                        if (res.ok) {
                            alert('æ·»åŠ æˆåŠŸï¼');
                            this.newSchedule = { company_name: '', position_name: '', interview_time: '', interview_type: 'è§†é¢‘é¢è¯•', location: '', notes: '', status: 'å¾…é¢è¯•' };
                            await this.loadSchedules();
                            await this.loadUpcomingInterviews();
                        } else {
                            alert('æ·»åŠ å¤±è´¥');
                        }
                    } catch (error) {
                        alert('æ·»åŠ å¤±è´¥: ' + error.message);
                    }
                },

                async deleteSchedule(scheduleId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡é¢è¯•æ—¥ç¨‹å—ï¼Ÿ')) return;

                    try {
                        const res = await fetch(`${API_BASE}/schedules/${scheduleId}`, { method: 'DELETE' });
                        if (res.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            await this.loadSchedules();
                            await this.loadUpcomingInterviews();
                        }
                    } catch (error) {
                        alert('åˆ é™¤å¤±è´¥: ' + error.message);
                    }
                },

                // ========== å²—ä½åˆ†æ ==========
                async loadJobAnalyses() {
                    try {
                        const res = await fetch(`${API_BASE}/job-analysis/`);
                        this.jobAnalyses = await res.json();
                    } catch (error) {
                        console.error('åŠ è½½å²—ä½åˆ†æå¤±è´¥:', error);
                    }
                },

                async saveJobAnalysis(triggerAnalysis = false) {
                    if (!this.newJobAnalysis.job_title || !this.newJobAnalysis.jd_content) {
                        alert('è¯·å¡«å†™å²—ä½åç§°å’ŒJDå†…å®¹');
                        return;
                    }

                    this.analyzingJob = triggerAnalysis; // åªæœ‰è§¦å‘åˆ†ææ—¶æ‰æ˜¾ç¤ºloading
                    try {
                        // æ·»åŠ  trigger_analysis æŸ¥è¯¢å‚æ•°
                        const url = triggerAnalysis
                            ? `${API_BASE}/job-analysis/?trigger_analysis=true`
                            : `${API_BASE}/job-analysis/?trigger_analysis=false`;

                        const res = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newJobAnalysis)
                        });

                        if (res.ok) {
                            if (triggerAnalysis) {
                                alert('âœ… ä¿å­˜æˆåŠŸï¼AIåˆ†æå·²åœ¨åå°å¯åŠ¨ï¼Œæ‚¨å¯ä»¥ç»§ç»­å…¶ä»–æ“ä½œã€‚');
                            } else {
                                alert('âœ… ä¿å­˜æˆåŠŸï¼');
                            }
                            this.newJobAnalysis = { job_title: '', company_name: '', jd_content: '' };
                            await this.loadJobAnalyses();
                        } else {
                            alert('æäº¤å¤±è´¥');
                        }
                    } catch (error) {
                        alert('æäº¤å¤±è´¥: ' + error.message);
                    } finally {
                        this.analyzingJob = false;
                    }
                },

                async triggerAnalysis(analysisId) {
                    try {
                        const res = await fetch(`${API_BASE}/job-analysis/${analysisId}/analyze`, {
                            method: 'POST'
                        });

                        if (res.ok) {
                            alert('âœ… AIåˆ†æå·²å¯åŠ¨ï¼Œæ­£åœ¨åå°å¤„ç†...');
                            // ç«‹å³åˆ·æ–°åˆ—è¡¨ï¼Œæ˜¾ç¤ºprocessingçŠ¶æ€
                            await this.loadJobAnalyses();
                        } else {
                            const data = await res.json();
                            alert('å¯åŠ¨åˆ†æå¤±è´¥: ' + (data.detail || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        alert('å¯åŠ¨åˆ†æå¤±è´¥: ' + error.message);
                    }
                },

                async deleteJobAnalysis(analysisId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å²—ä½åˆ†æå—ï¼Ÿ')) return;

                    try {
                        const res = await fetch(`${API_BASE}/job-analysis/${analysisId}`, { method: 'DELETE' });
                        if (res.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            await this.loadJobAnalyses();
                        }
                    } catch (error) {
                        alert('åˆ é™¤å¤±è´¥: ' + error.message);
                    }
                },

                // ========== Chatbot AIåŠ©æ‰‹ ==========
                startNewChat() {
                    // ç”Ÿæˆä¼šè¯åç§°ï¼ˆä½¿ç”¨æ—¶é—´æˆ³ï¼‰
                    const now = new Date();
                    const sessionName = `å¯¹è¯ ${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

                    // åˆ›å»ºæ–°ä¼šè¯
                    const newSession = {
                        sessionId: 'session-' + Date.now(),
                        sessionName: sessionName,
                        messages: [],
                        debugHistory: [],
                        debugCurrentTab: 0,
                        createdAt: now.toISOString()
                    };

                    // æ·»åŠ åˆ°ä¼šè¯åˆ—è¡¨
                    this.chatSessions.push(newSession);
                    // åˆ‡æ¢åˆ°æ–°ä¼šè¯
                    this.currentChatSessionIndex = this.chatSessions.length - 1;
                    this.chatInput = '';
                },

                switchToSession(index) {
                    this.currentChatSessionIndex = index;
                },

                deleteSession(index) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ')) {
                        return;
                    }
                    this.chatSessions.splice(index, 1);
                    // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰ä¼šè¯ï¼Œåˆ‡æ¢åˆ°æœ€åä¸€ä¸ªä¼šè¯
                    if (this.currentChatSessionIndex >= this.chatSessions.length) {
                        this.currentChatSessionIndex = this.chatSessions.length - 1;
                    }
                    // å¦‚æœæ²¡æœ‰ä¼šè¯äº†ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯
                    if (this.chatSessions.length === 0) {
                        this.startNewChat();
                    }
                },

                async sendChatMessage() {
                    if (!this.chatInput.trim() || this.chatStreaming || !this.currentSession) {
                        return;
                    }

                    const userMessage = this.chatInput.trim();

                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å½“å‰ä¼šè¯
                    this.currentSession.messages.push({
                        role: 'user',
                        content: userMessage,
                        timestamp: new Date()
                    });

                    // æ¸…ç©ºè¾“å…¥æ¡†
                    this.chatInput = '';

                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    this.$nextTick(() => {
                        const chatContainer = document.getElementById('chatMessages');
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    });

                    // å¼€å§‹æµå¼æ¥æ”¶
                    this.chatStreaming = true;

                    try {
                        // æ„å»ºè¯·æ±‚æ•°æ®
                        const requestData = {
                            session_id: this.currentSession.sessionId,
                            message: userMessage,
                            use_rag: this.chatUseRag,
                            model: this.chatModel || null,
                            dev_mode: this.chatDevMode,
                            enable_search: this.chatEnableSearch
                        };

                        // ä½¿ç”¨EventSourceæ¥æ”¶SSEæµ
                        const url = `${API_BASE}/chat/stream`;
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();

                        // æ·»åŠ AIæ¶ˆæ¯å ä½ç¬¦åˆ°å½“å‰ä¼šè¯
                        const messageIndex = this.currentSession.messages.length;
                        this.currentSession.messages.push({
                            role: 'assistant',
                            content: '',
                            timestamp: new Date()
                        });

                        while (true) {
                            const { done, value } = await reader.read();

                            if (done) {
                                break;
                            }

                            // è§£ç chunk
                            const chunk = decoder.decode(value, { stream: true });
                            const lines = chunk.split('\n');

                            for (const line of lines) {
                                if (!line.trim()) {
                                    continue;
                                }

                                // æ£€æŸ¥æ˜¯å¦æ˜¯data:å¼€å¤´
                                if (!line.startsWith('data: ')) {
                                    continue;
                                }

                                const data = line.slice(6); // ç§»é™¤ "data: " å‰ç¼€

                                if (data === '[DONE]') {
                                    console.log('æ”¶åˆ°[DONE]ä¿¡å·');
                                    break;
                                }

                                try {
                                    const parsed = JSON.parse(data);
                                    console.log('æ”¶åˆ°chunk:', parsed);

                                    // å¤„ç†é”™è¯¯
                                    if (parsed.type === 'error') {
                                        throw new Error(parsed.error);
                                    }

                                    // å¤„ç†è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘è€…æ¨¡å¼ï¼‰
                                    if (parsed.id === 'debug' && parsed.choices && parsed.choices[0].delta.content) {
                                        try {
                                            const debugInfo = JSON.parse(parsed.choices[0].delta.content);
                                            // æ·»åŠ åˆ°å½“å‰ä¼šè¯çš„è°ƒè¯•å†å²
                                            this.currentSession.debugHistory.push(debugInfo);
                                            // è‡ªåŠ¨åˆ‡æ¢åˆ°æœ€æ–°çš„tab
                                            this.currentSession.debugCurrentTab = this.currentSession.debugHistory.length - 1;
                                            console.log(`ğŸ“Š Debug Info Round ${this.currentSession.debugHistory.length}:`, debugInfo);
                                        } catch (e) {
                                            console.error('Failed to parse debug info:', e);
                                        }
                                        continue; // è·³è¿‡è¿™ä¸ªchunkï¼Œä¸æ·»åŠ åˆ°æ¶ˆæ¯ä¸­
                                    }

                                    // æå–å¢é‡å†…å®¹
                                    if (parsed.choices && parsed.choices.length > 0) {
                                        const delta = parsed.choices[0].delta;
                                        if (delta && delta.content) {
                                            // ç›´æ¥ä¿®æ”¹å½“å‰ä¼šè¯çš„æ¶ˆæ¯ï¼Œè§¦å‘Alpineå“åº”å¼æ›´æ–°
                                            this.currentSession.messages[messageIndex].content += delta.content;
                                            console.log('ç´¯ç§¯å†…å®¹é•¿åº¦:', this.currentSession.messages[messageIndex].content.length);

                                            // æ»šåŠ¨åˆ°åº•éƒ¨
                                            this.$nextTick(() => {
                                                const chatContainer = document.getElementById('chatMessages');
                                                if (chatContainer) {
                                                    chatContainer.scrollTop = chatContainer.scrollHeight;
                                                }
                                            });
                                        }
                                    }
                                } catch (parseError) {
                                    console.error('è§£æé”™è¯¯:', parseError, 'Data:', data);
                                }
                            }
                        }

                    } catch (error) {
                        console.error('Chat error:', error);
                        alert('å‘é€å¤±è´¥: ' + error.message);

                        // ç§»é™¤æœªå®Œæˆçš„AIæ¶ˆæ¯
                        if (this.currentSession && this.currentSession.messages.length > 0 &&
                            this.currentSession.messages[this.currentSession.messages.length - 1].role === 'assistant') {
                            this.currentSession.messages.pop();
                        }
                    } finally {
                        this.chatStreaming = false;

                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        this.$nextTick(() => {
                            const chatContainer = document.getElementById('chatMessages');
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
